<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
<style>
  /* ---------- Base ---------- */
  :root{
    --bg:#f6f8fa;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#2563eb;
    --accent-2:#0ea5a4;
    --danger:#ef4444;
    --success:#10b981;
    --border:#e6e9ee;
    --shadow: 0 6px 18px rgba(16,24,40,0.06);
    --radius:10px;
    --gap:14px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, "Noto Sans Thai", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,#eef2ff 0%, #fbfdff 100%);
    color:#0f172a;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
  }
  h1{margin:0 0 6px 0;font-size:20px}
  h2{margin:18px 0 8px 0;font-size:16px;color:#0f172a}
  p.lead{margin:0 0 18px 0;color:var(--muted);font-size:13px}

  /* ---------- Layout ---------- */
  .container{
    max-width:1200px;
    margin:0 auto;
    display:grid;
    grid-template-columns: 1fr;
    gap:20px;
  }

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:18px;
    box-shadow:var(--shadow);
  }

  /* ---------- Form (grid) ---------- */
  form#memberForm{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:12px;
    align-items:start;
  }

  @media (max-width:880px){
    form#memberForm{grid-template-columns:1fr}
  }

  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .field label{
    font-size:12px;
    color:var(--muted);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .field input[type="text"],
  .field input[type="date"],
  .field select{
    padding:10px 12px;
    border:1px solid var(--border);
    border-radius:8px;
    outline:none;
    font-size:14px;
    background:linear-gradient(180deg,#fff,#fbfdff);
    transition:box-shadow .12s, border-color .12s;
  }
  .field input[type="checkbox"]{width:18px;height:18px}
  .field input:focus,
  .field select:focus{
    box-shadow:0 6px 18px rgba(37,99,235,0.08);
    border-color:var(--accent);
  }
  .required { color:var(--danger); margin-left:6px; font-size:12px; }

  /* wide inputs spanning two columns */
  .full { grid-column: 1 / -1; }

  /* action buttons */
  .actions{
    display:flex;
    gap:8px;
    align-items:center;
    margin-top:6px;
  }
  button.primary{
    background:linear-gradient(90deg,var(--accent), #1e40af);
    color:white;
    border:none;
    padding:10px 14px;
    border-radius:8px;
    cursor:pointer;
    box-shadow: 0 8px 20px rgba(37,99,235,0.12);
    display:inline-flex;
    gap:8px;
    align-items:center;
  }
  button.ghost{
    background:transparent;
    border:1px solid var(--border);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
  }
  button.danger{
    background:var(--danger);
    color:#fff;
    border:none;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
  }

  /* ---------- Filter bar ---------- */
  #filterDiv{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  #filterDiv input, #filterDiv select{
    width:220px;
    padding:9px 10px;
    border-radius:8px;
    border:1px solid var(--border);
  }

  #resultCount{font-weight:600;color:var(--muted); margin-left:8px;}

  /* ---------- Table ---------- */
  .table-wrap{ overflow:auto; }
  table{ width:100%; border-collapse:collapse; min-width:900px; background:transparent; }
  thead th{
    text-align:center;
    padding:12px 10px;
    border-bottom:1px solid #e9eef5;
    background:linear-gradient(180deg,#ffffff,#fbfdff);
    position:sticky;
    top:0;
    z-index:2;
    font-size:13px;
    color:#0f172a;
  }
  tbody td{
    padding:10px;
    border-bottom:1px dashed #f0f3f8;
    font-size:13px;
    color:#0f172a;
  }
  tbody tr:nth-child(odd){ background: linear-gradient(90deg,#ffffff,#fcfcff); }
  tbody tr:hover{ background:linear-gradient(90deg,#f1f6ff,#fbfdff); }

  .small{ font-size:12px; color:var(--muted) }

  /* sort icon */
  .sort-icon{ font-size:12px; opacity:0.8; margin-left:6px; }

  /* table action buttons */
  .btn-sm{ padding:6px 8px; border-radius:8px; border:none; cursor:pointer; font-size:13px }
  .btn-edit{ background:#f3f4f6; color:#0f172a; border:1px solid #e6e9ee; }
  .btn-del{ background:linear-gradient(90deg,#fee2e2,#fecaca); color:var(--danger); border:1px solid #fcdcdc; }

  /* pagination */
  .pagination{ display:flex; gap:8px; justify-content:center; align-items:center; margin-top:12px; }
  .page-info{font-size:13px;color:var(--muted)}

  /* responsive tweaks */
  @media (max-width:680px){
    #filterDiv input, #filterDiv select{ width:100%; }
    table{ min-width:720px; }
  }
</style>
</head>
<body>
  <div class="container">

    <div class="card">
      <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
      <p class="lead">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏ö ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‚Äî ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î <strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</strong></p>

      <form id="memberForm" autocomplete="off" class="card-form">
        <!-- Left column -->
        <div class="field">
          <label>‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span class="required">*</span></label>
          <input name="member_id" placeholder="‡πÄ‡∏ä‡πà‡∏ô 001A" required>
        </div>

        <div class="field">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span class="required">*</span></label>
          <input type="date" name="join_date" required>
        </div>

        <div class="field">
          <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ <span class="required">*</span></label>
          <input name="title" placeholder="‡∏ô‡∏≤‡∏¢/‡∏ô‡∏≤‡∏á/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß" required>
        </div>

        <div class="field">
          <label>‡∏ä‡∏∑‡πà‡∏≠ <span class="required">*</span></label>
          <input name="first_name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢" required>
        </div>

        <div class="field">
          <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label>
          <input name="last_name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏à‡∏î‡∏µ" required>
        </div>

        <div class="field">
          <label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô <span class="required">*</span></label>
          <input name="id_card" placeholder="13 ‡∏´‡∏•‡∏±‡∏Å (‡πÑ‡∏°‡πà‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ)" required>
        </div>

        <div class="field">
          <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î <span class="required">*</span></label>
          <input type="date" name="birthday" required>
        </div>

        <div class="field">
          <label>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà <span class="required">*</span></label>
          <input name="group" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡∏∏‡πà‡∏° A" required>
        </div>

        <!-- Right column -->
        <div class="field">
          <label>‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <span class="required">*</span></label>
          <input name="house_no" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12/3" required>
        </div>

        <div class="field">
          <label>‡∏´‡∏°‡∏π‡πà</label>
          <input name="moo" placeholder="‡πÄ‡∏ä‡πà‡∏ô 4">
        </div>

        <div class="field">
          <label>‡∏ñ‡∏ô‡∏ô <span class="required">*</span></label>
          <input name="street" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó" required>
        </div>

        <div class="field">
          <label>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</label>
          <input name="village" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
        </div>

        <div class="field">
          <label>‡∏ï‡∏≥‡∏ö‡∏• <span class="required">*</span></label>
          <input name="subdistrict" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏≤‡∏á‡∏ô‡∏≤" required>
        </div>

        <div class="field">
          <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <span class="required">*</span></label>
          <input name="district" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏≤‡∏á‡∏ô‡∏≤" required>
        </div>

        <div class="field">
          <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span class="required">*</span></label>
          <input name="province" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£" required>
        </div>

        <div class="field">
          <label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå <span class="required">*</span></label>
          <input name="postal_code" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10110" required>
        </div>

        <div class="field">
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
          <input name="phone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678">
        </div>

        <div class="field">
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á</label>
          <input name="phone_alt" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
        </div>

        <div class="field">
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span class="required">*</span></label>
          <select name="member_status" required>
            <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞--</option>
            <option value="‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
            <option value="‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
            <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
          </select>
        </div>

        <div class="field">
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏£‡∏™ <span class="required">*</span></label>
          <select name="marital_status" required>
            <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞--</option>
            <option value="‡πÇ‡∏™‡∏î">‡πÇ‡∏™‡∏î</option>
            <option value="‡∏´‡∏°‡πâ‡∏≤‡∏¢">‡∏´‡∏°‡πâ‡∏≤‡∏¢</option>
            <option value="‡∏´‡∏¢‡πà‡∏≤">‡∏´‡∏¢‡πà‡∏≤</option>
          </select>
        </div>

        <div class="field">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™</label>
          <input name="spouse_name" placeholder="‡∏ñ‡πâ‡∏≤‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏£‡∏™">
        </div>

        <div class="field">
          <label>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Å‡∏¢‡∏ó</label>
          <div style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" name="kyot_member">
            <input name="kyot_member_id" placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Å‡∏¢‡∏ó (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" style="flex:1;padding:9px;border-radius:8px;border:1px solid var(--border)">
          </div>
        </div>

        <div class="field full">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏¥‡∏î‡∏≤</label>
          <input name="father_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏¥‡∏î‡∏≤">
        </div>

        <div class="field full">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏£‡∏î‡∏≤</label>
          <input name="mother_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏£‡∏î‡∏≤">
        </div>

        <div class="full" style="display:flex;gap:10px;align-items:center">
          <button class="primary" type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button" class="ghost" onclick="document.getElementById('memberForm').reset()">‚ü≤ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
          <button type="button" class="danger" onclick="if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) document.getElementById('memberForm').reset()">‡∏•‡πâ‡∏≤‡∏á</button>
          <div style="margin-left:auto" class="small">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ <span class="required">*</span> ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å</div>
        </div>
      </form>
    </div>

    <div class="card">
      <h2>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
      <div id="filterDiv" style="margin-bottom:12px">
        <input id="searchMemberId" placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">
        <input id="searchName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ / ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
        <input id="searchGroup" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°">
        <input id="searchProvince" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
        <select id="searchStatus">
          <option value="">--‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>
          <option value="‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
          <option value="‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
          <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
        </select>
        <span id="resultCount">‡∏û‡∏ö 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
      </div>

      <div class="table-wrap">
        <table id="memberTable" aria-describedby="resultCount">
          <thead>
            <tr>
              <th data-column="member_id">‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span class="sort-icon"></span></th>
              <th data-column="first_name">‡∏ä‡∏∑‡πà‡∏≠ <span class="sort-icon"></span></th>
              <th data-column="last_name">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="sort-icon"></span></th>
              <th data-column="group">‡∏Å‡∏•‡∏∏‡πà‡∏° <span class="sort-icon"></span></th>
              <th data-column="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span class="sort-icon"></span></th>
              <th data-column="member_status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <span class="sort-icon"></span></th>
              <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
              <th>‡∏•‡∏ö</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="pagination">
        <button id="prevPage" class="ghost">‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
        <div class="page-info" id="pageInfo">‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏à‡∏≤‡∏Å 1</div>
        <button id="nextPage" class="ghost">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
      </div>
    </div>

  </div>

<script>
/* ------------------- Config / Globals ------------------- */
const API_URL = 'https://ttottijljxoinptmhgtu.supabase.co/functions/v1/members';

const form = document.getElementById('memberForm');
const tableBody = document.querySelector('#memberTable tbody');

let editId = null;
let allMembers = [];
let sortColumn = null;
let sortAsc = true;

// pagination
let currentPage = 1;
const rowsPerPage = 10;

/* ------------------- Load members ------------------- */
async function loadMembers() {
  try {
    const res = await fetch(API_URL);
    const result = await res.json();

    if (result.error) {
      alert(result.error);
      return;
    }
    if (!Array.isArray(result.data)) {
      alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å server");
      return;
    }

    allMembers = result.data;
    currentPage = 1;
    filterMembers();

  } catch (err) {
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err);
  }
}

/* ------------------- Render table (with paging) ------------------- */
function renderTable(members) {
  tableBody.innerHTML = '';

  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const paged = members.slice(start, end);

  paged.forEach(m => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${escapeHtml(m.member_id || '')}</td>
      <td>${escapeHtml(m.first_name || '')}</td>
      <td>${escapeHtml(m.last_name || '')}</td>
      <td>${escapeHtml(m.group || '')}</td>
      <td>${escapeHtml(m.province || '')}</td>
      <td>${escapeHtml(m.member_status || '')}</td>
      <td><button class="btn-sm btn-edit" onclick="editMember('${encodeURIComponent(m.member_id)}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
      <td><button class="btn-sm btn-del" onclick="deleteMember('${encodeURIComponent(m.member_id)}')">‡∏•‡∏ö</button></td>
    `;
    tableBody.appendChild(tr);
  });

  const totalPages = Math.max(1, Math.ceil(members.length / rowsPerPage));
  document.getElementById('pageInfo').textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${currentPage} ‡∏à‡∏≤‡∏Å ${totalPages}`;
  document.getElementById('resultCount').textContent = `‡∏û‡∏ö ${members.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
}

/* ------------------- Filter + Sort ------------------- */
function filterMembers() {
  const idFilter = document.getElementById('searchMemberId').value.trim().toLowerCase();
  const nameFilter = document.getElementById('searchName').value.trim().toLowerCase();
  const groupFilter = document.getElementById('searchGroup').value.trim().toLowerCase();
  const provinceFilter = document.getElementById('searchProvince').value.trim().toLowerCase();
  const statusFilter = document.getElementById('searchStatus').value;

  let filtered = allMembers.filter(m => {
    return (!idFilter || (m.member_id || '').toString().toLowerCase().includes(idFilter)) &&
           (!nameFilter || ((m.first_name||'').toString().toLowerCase().includes(nameFilter) || (m.last_name||'').toString().toLowerCase().includes(nameFilter))) &&
           (!groupFilter || ((m.group||'').toString().toLowerCase().includes(groupFilter))) &&
           (!provinceFilter || ((m.province||'').toString().toLowerCase().includes(provinceFilter))) &&
           (!statusFilter || (m.member_status||'') === statusFilter);
  });

  if (sortColumn) {
    filtered.sort((a,b) => {
      let A = (a[sortColumn]||'').toString().toLowerCase();
      let B = (b[sortColumn]||'').toString().toLowerCase();
      if (A < B) return sortAsc ? -1 : 1;
      if (A > B) return sortAsc ? 1 : -1;
      return 0;
    });
  }

  // ensure currentPage within range
  const totalPages = Math.max(1, Math.ceil(filtered.length / rowsPerPage));
  if (currentPage > totalPages) currentPage = totalPages;
  renderTable(filtered);
}

/* ------------------- Filter events (realtime) ------------------- */
['searchMemberId','searchName','searchGroup','searchProvince'].forEach(id => {
  document.getElementById(id).addEventListener('input', () => { currentPage = 1; filterMembers(); });
});
document.getElementById('searchStatus').addEventListener('change', () => { currentPage = 1; filterMembers(); });

/* ------------------- Sorting ------------------- */
function clearSortIcons(){
  document.querySelectorAll('.sort-icon').forEach(el => el.textContent = '');
}
function sortTable(column){
  if (sortColumn === column) sortAsc = !sortAsc; else { sortColumn = column; sortAsc = true; }
  clearSortIcons();
  const icon = document.querySelector(`th[data-column="${column}"] .sort-icon`);
  if(icon) icon.textContent = sortAsc ? '‚ñ≤' : '‚ñº';
  filterMembers();
}
document.querySelectorAll('#memberTable th[data-column]').forEach(th => {
  th.addEventListener('click', () => sortTable(th.dataset.column));
});

/* ------------------- Pagination controls ------------------- */
document.getElementById('prevPage').addEventListener('click', () => {
  if (currentPage > 1) { currentPage--; filterMembers(); }
});
document.getElementById('nextPage').addEventListener('click', () => {
  // compute filtered length
  const idFilter = document.getElementById('searchMemberId').value.trim().toLowerCase();
  const nameFilter = document.getElementById('searchName').value.trim().toLowerCase();
  const groupFilter = document.getElementById('searchGroup').value.trim().toLowerCase();
  const provinceFilter = document.getElementById('searchProvince').value.trim().toLowerCase();
  const statusFilter = document.getElementById('searchStatus').value;

  const filtered = allMembers.filter(m => {
    return (!idFilter || (m.member_id||'').toString().toLowerCase().includes(idFilter)) &&
           (!nameFilter || ((m.first_name||'').toString().toLowerCase().includes(nameFilter) || (m.last_name||'').toString().toLowerCase().includes(nameFilter))) &&
           (!groupFilter || ((m.group||'').toString().toLowerCase().includes(groupFilter))) &&
           (!provinceFilter || ((m.province||''
