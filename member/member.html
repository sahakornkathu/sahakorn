<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¡à¸²à¸Šà¸´à¸</title>
<style>
body { font-family:sans-serif; background:#f3f4f6; padding:20px }
form, table { background:#fff; padding:15px; border-radius:6px }
input, select { padding:6px; margin:4px; width:200px }
table { width:100%; border-collapse:collapse; margin-top:20px }
th, td { border:1px solid #ddd; padding:8px }
th { background:#eee }
</style>
</head>
<body>

<h2>ğŸ“‹ à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¡à¸²à¸Šà¸´à¸</h2>

<form id="memberForm">
  <input type="number" id="member_id" placeholder="à¸£à¸«à¸±à¸ªà¸ªà¸¡à¸²à¸Šà¸´à¸" required>
  <input type="date" id="join_date">
  <input id="title" placeholder="à¸„à¸³à¸™à¸³à¸«à¸™à¹‰à¸²">
  <input id="first_name" placeholder="à¸Šà¸·à¹ˆà¸­" required>
  <input id="last_name" placeholder="à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥" required>
  <input id="id_card" placeholder="à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™">
  <input type="date" id="birthday">
  <input id="group" placeholder="à¸à¸¥à¸¸à¹ˆà¸¡">
  <input id="house_no" placeholder="à¸šà¹‰à¸²à¸™à¹€à¸¥à¸‚à¸—à¸µà¹ˆ">
  <input id="moo" placeholder="à¸«à¸¡à¸¹à¹ˆ">
  <input id="street" placeholder="à¸–à¸™à¸™">
  <input id="village" placeholder="à¸«à¸¡à¸¹à¹ˆà¸šà¹‰à¸²à¸™">
  <input id="subdistrict" placeholder="à¸•à¸³à¸šà¸¥">
  <input id="district" placeholder="à¸­à¸³à¹€à¸ à¸­">
  <input id="province" placeholder="à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”">
  <input id="postal_code" placeholder="à¸£à¸«à¸±à¸ªà¹„à¸›à¸£à¸©à¸“à¸µà¸¢à¹Œ">
  <input id="phone" placeholder="à¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ">
  <input id="phone_alt" placeholder="à¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œà¸ªà¸³à¸£à¸­à¸‡">

  <select id="member_status">
    <option value="">à¸ªà¸–à¸²à¸™à¸°à¸ªà¸¡à¸²à¸Šà¸´à¸</option>
    <option value="active">à¸›à¸à¸•à¸´</option>
    <option value="inactive">à¸à¹‰à¸™à¸ªà¸ à¸²à¸</option>
  </select>

  <select id="marital_status">
    <option value="">à¸ªà¸–à¸²à¸™à¸ à¸²à¸</option>
    <option value="single">à¹‚à¸ªà¸”</option>
    <option value="married">à¸ªà¸¡à¸£à¸ª</option>
  </select>

  <input id="spouse_name" placeholder="à¸Šà¸·à¹ˆà¸­à¸„à¸¹à¹ˆà¸ªà¸¡à¸£à¸ª">

  <br><br>
  <button type="submit">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸</button>
  <button type="button" onclick="resetForm()">à¸¢à¸à¹€à¸¥à¸´à¸</button>
</form>

<table>
<thead>
<tr>
  <th>à¸£à¸«à¸±à¸ª</th>
  <th>à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥</th>
  <th>à¹‚à¸—à¸£</th>
  <th>à¸ªà¸–à¸²à¸™à¸°</th>
  <th>à¸ˆà¸±à¸”à¸à¸²à¸£</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const SUPABASE_URL = 'https://ttottijljxoinptmhgtu.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y'

const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

const form = document.getElementById('memberForm')
const rows = document.getElementById('rows')

/* ================= LOAD ================= */
async function loadMembers() {
  const { data, error } = await db
    .from('members')
    .select('*')
    .order('member_id')

  console.log('LOAD DATA:', data)
  console.log('LOAD ERROR:', error)

  if (error) {
    alert('à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸”à¸¹ console')
    return
  }

  rows.innerHTML = ''
  data.forEach(m => {
    rows.innerHTML += `
      <tr>
        <td>${m.member_id}</td>
        <td>${m.first_name ?? ''} ${m.last_name ?? ''}</td>
        <td>${m.phone ?? ''}</td>
        <td>${m.member_status ?? ''}</td>
        <td>
          <button onclick='editMember(${JSON.stringify(m)})'>âœï¸</button>
          <button onclick="deleteMember(${m.member_id})">ğŸ—‘</button>
        </td>
      </tr>`
  })
}

/* ================= SAVE / UPDATE ================= */
form.addEventListener('submit', async e => {
  e.preventDefault()

  const data = Object.fromEntries(
    [...form.elements]
      .filter(el => el.id)
      .map(el => [el.id, el.value || null])
  )

  console.log('SAVE DATA:', data)

  const { error } = await db
    .from('members')
    .upsert([data], { onConflict: 'member_id' })

  if (error) {
    console.error('SAVE ERROR:', error)
    alert('à¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸”à¸¹ console')
    return
  }

  resetForm()
  loadMembers()
})

/* ================= EDIT ================= */
window.editMember = m => {
  member_id.value = m.member_id
  member_id.disabled = true

  for (const key in m) {
    if (document.getElementById(key)) {
      document.getElementById(key).value = m[key] ?? ''
    }
  }
}

/* ================= DELETE ================= */
window.deleteMember = async id => {
  if (!confirm('à¸¢à¸·à¸™à¸¢à¸±à¸™à¸¥à¸šà¸ªà¸¡à¸²à¸Šà¸´à¸à¸™à¸µà¹‰?')) return

  const { error } = await db
    .from('members')
    .delete()
    .eq('member_id', id)

  if (error) {
    console.error('DELETE ERROR:', error)
    alert('à¸¥à¸šà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸”à¸¹ console')
    return
  }

  loadMembers()
}

/* ================= RESET ================= */
window.resetForm = () => {
  form.reset()
  member_id.disabled = false
}

/* ================= INIT ================= */
loadMembers()
</script>

</body>
</html>
