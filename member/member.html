<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f9fafb; font-family: "Prompt", sans-serif; }
    .card { background: white; border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.08); padding: 2rem; }
    .step { display: none; }
    .step.active { display: block; }
    .step-buttons button { transition: 0.3s; }
    .step-buttons button:hover { opacity: 0.9; }
    table th { background-color: #1e3a8a; color: white; padding: 0.5rem; text-align: center; }
    table td { padding: 0.5rem; text-align: center; }
    input, select {
      width: 100%;
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #cbd5e1;
      margin-top: 0.25rem;
    }
    label { font-weight: 500; color: #1e293b; }
  </style>
</head>
<body class="p-6">

  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-blue-900 text-center mb-6">
      üßæ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå
    </h1>

    <!-- ‚úÖ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö Step -->
    <div class="card">
      <form id="memberForm">
        <input type="hidden" id="member_id">

        <!-- Step 1 -->
        <div class="step active" id="step1">
          <h2 class="text-xl font-semibold text-blue-800 mb-3">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label><input type="date" id="join_date" required></div>
            <div><label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
              <select id="title" required>
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                <option>‡∏ô‡∏≤‡∏¢</option><option>‡∏ô‡∏≤‡∏á</option><option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
              </select>
            </div>
            <div><label>‡∏ä‡∏∑‡πà‡∏≠</label><input type="text" id="first_name" required></div>
            <div><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="last_name" required></div>
            <div><label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label><input type="text" id="id_card" maxlength="13" required></div>
            <div><label>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label><input type="date" id="birthday" required></div>
            <div><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏£‡∏™</label>
              <select id="marital_status"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option><option>‡πÇ‡∏™‡∏î</option><option>‡∏´‡∏°‡πâ‡∏≤‡∏¢</option><option>‡∏´‡∏¢‡πà‡∏≤</option></select>
            </div>
            <div><label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™</label><input type="text" id="spouse_name"></div>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="step" id="step2">
          <h2 class="text-xl font-semibold text-blue-800 mb-3">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 : ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div><label>‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label><input type="text" id="house_no" required></div>
            <div><label>‡∏´‡∏°‡∏π‡πà</label><input type="text" id="moo"></div>
            <div><label>‡∏ñ‡∏ô‡∏ô</label><input type="text" id="street" required></div>
            <div><label>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</label><input type="text" id="village"></div>
            <div><label>‡∏ï‡∏≥‡∏ö‡∏•</label><input type="text" id="subdistrict" required></div>
            <div><label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label><input type="text" id="district" required></div>
            <div><label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label><input type="text" id="province" required></div>
            <div><label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</label><input type="text" id="postal_code" required></div>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="step" id="step3">
          <h2 class="text-xl font-semibold text-blue-800 mb-3">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3 : ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="text" id="phone" required></div>
            <div><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á</label><input type="text" id="phone_alt"></div>
          </div>
        </div>

        <!-- Step 4 -->
        <div class="step" id="step4">
          <h2 class="text-xl font-semibold text-blue-800 mb-3">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
              <select id="member_status">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                <option>‡∏õ‡∏Å‡∏ï‡∏¥</option><option>‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option><option>‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
              </select>
            </div>
            <div><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏¥‡∏î‡∏≤</label><input type="text" id="father_name"></div>
            <div><label>‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏£‡∏î‡∏≤</label><input type="text" id="mother_name"></div>
            <div><label>‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Å‡∏¢‡∏ó ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
              <select id="rubber_member">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                <option>‡πÉ‡∏ä‡πà</option><option>‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</option>
              </select>
            </div>
            <div><label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label><input type="text" id="remark"></div>
          </div>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
        <div class="step-buttons flex justify-between mt-6">
          <button type="button" id="prevBtn" class="bg-gray-400 text-white px-4 py-2 rounded">‚¨ÖÔ∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <button type="button" id="nextBtn" class="bg-blue-700 text-white px-4 py-2 rounded">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°Ô∏è</button>
          <button type="button" id="saveBtn" class="hidden bg-green-600 text-white px-4 py-2 rounded">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>

    <!-- üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
    <div class="card mt-6">
      <h2 class="text-xl font-semibold text-blue-800 mb-3">üìú ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full border">
          <thead>
            <tr>
              <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
              <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
              <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="memberTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://ttottijljxoinptmhgtu.supabase.co/functions/v1/members";
    let currentStep = 1;
    function showStep(step) {
      document.querySelectorAll(".step").forEach((el, i) => el.classList.toggle("active", i + 1 === step));
      document.getElementById("prevBtn").style.display = step === 1 ? "none" : "inline-block";
      document.getElementById("nextBtn").style.display = step === 4 ? "none" : "inline-block";
      document.getElementById("saveBtn").style.display = step === 4 ? "inline-block" : "none";
    }
    showStep(currentStep);
    document.getElementById("nextBtn").onclick = () => { if (currentStep < 4) currentStep++; showStep(currentStep); };
    document.getElementById("prevBtn").onclick = () => { if (currentStep > 1) currentStep--; showStep(currentStep); };

    async function loadMembers() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const table = document.getElementById("memberTable");
      table.innerHTML = "";
      if (!Array.isArray(data)) return;
      data.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${m.member_id}</td>
          <td>${m.title || ""}${m.first_name || ""} ${m.last_name || ""}</td>
          <td>${m.phone || "-"}</td>
          <td>${m.join_date || "-"}</td>
          <td>${m.member_status || "-"}</td>
          <td>
            <button class="bg-yellow-500 text-white px-2 py-1 rounded" onclick='editMember(${JSON.stringify(m)})'>‚úèÔ∏è</button>
            <button class="bg-red-600 text-white px-2 py-1 rounded" onclick='deleteMember("${m.member_id}")'>üóëÔ∏è</button>
          </td>`;
        table.appendChild(tr);
      });
    }

    document.getElementById("saveBtn").addEventListener("click", async () => {
      const ids = ["member_id","join_date","title","first_name","last_name","id_card","birthday","marital_status",
                   "spouse_name","house_no","moo","street","village","subdistrict","district","province","postal_code",
                   "phone","phone_alt","member_status","father_name","mother_name","rubber_member","remark"];
      const data = {};
      ids.forEach(id => data[id] = document.getElementById(id)?.value || "");
      if (!data.member_id) data.member_id = crypto.randomUUID();
      const res = await fetch(API_URL, { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify(data) });
      const json = await res.json();
      if (!res.ok) alert("‚ùå Error: " + (json.error || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ"));
      else {
        alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
        document.getElementById("memberForm").reset();
        currentStep = 1; showStep(currentStep); loadMembers();
      }
    });

    function editMember(m) {
      Object.keys(m).forEach(k => {
        if (document.getElementById(k)) document.getElementById(k).value = m[k];
      });
      window.scrollTo({ top: 0, behavior: "smooth" });
      currentStep = 1; showStep(currentStep);
    }

    async function deleteMember(id) {
      if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      const res = await fetch(`${API_URL}?member_id=${id}`, { method: "DELETE" });
      const json = await res.json();
      if (!res.ok) alert("‚ùå Error: " + (json.error || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ"));
      else { alert("üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); loadMembers(); }
    }

    loadMembers();
  </script>
</body>
</html>
