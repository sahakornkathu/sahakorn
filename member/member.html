<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body { background: #f7fafc; font-family: 'Prompt', sans-serif; }
    .step { display: none; }
    .step.active { display: block; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 1rem; background: #fff; box-shadow: 0 3px 8px rgba(0,0,0,0.08); }
    th, td { padding: 6px 8px; text-align: center; border: 1px solid #e2e8f0; }
    th { background: #2563eb; color: #fff; font-weight: 500; }
    tr:nth-child(even){ background:#f9fafb; }
    tr:hover{ background:#edf2f7; }
    .btn { padding:6px 12px; border-radius:6px; font-size:12px; color:#fff; }
    .btn-add { background:#10b981; }
    .btn-edit { background:#3b82f6; }
    .btn-del { background:#ef4444; }
  </style>
</head>
<body class="p-4">

  <h1 class="text-2xl font-bold mb-4 text-blue-700">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>

  <!-- üß≠ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö Step -->
  <form id="memberForm" class="bg-white p-4 rounded shadow-md">
    <div class="step active" id="step1">
      <h2 class="text-lg font-semibold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
      <div class="grid grid-cols-2 gap-3">
        <input id="member_id" placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å*" class="border p-2 rounded" required>
        <input id="join_date" type="date" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å*" class="border p-2 rounded" required>
        <select id="prefix" class="border p-2 rounded" required>
          <option value="">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
          <option>‡∏ô‡∏≤‡∏¢</option>
          <option>‡∏ô‡∏≤‡∏á</option>
          <option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
        </select>
        <input id="first_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠*" class="border p-2 rounded" required>
        <input id="last_name" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•*" class="border p-2 rounded" required>
        <input id="citizen_id" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô*" class="border p-2 rounded" required>
        <input id="birth_date" type="date" class="border p-2 rounded" required>
        <input id="group" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà*" class="border p-2 rounded" required>
      </div>
      <button type="button" id="next1" class="mt-3 btn btn-add">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    </div>

    <div class="step" id="step2">
      <h2 class="text-lg font-semibold mb-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h2>
      <div class="grid grid-cols-2 gap-3">
        <input id="house_no" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà*" class="border p-2 rounded" required>
        <input id="moo" placeholder="‡∏´‡∏°‡∏π‡πà" class="border p-2 rounded">
        <input id="road" placeholder="‡∏ñ‡∏ô‡∏ô*" class="border p-2 rounded" required>
        <input id="village" placeholder="‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô" class="border p-2 rounded">
        <input id="subdistrict" placeholder="‡∏ï‡∏≥‡∏ö‡∏•*" class="border p-2 rounded" required>
        <input id="district" placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠*" class="border p-2 rounded" required>
        <input id="province" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î*" class="border p-2 rounded" required>
        <input id="zipcode" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå*" class="border p-2 rounded" required>
      </div>
      <div class="flex justify-between mt-3">
        <button type="button" id="back1" class="btn btn-edit">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button type="button" id="next2" class="btn btn-add">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
      </div>
    </div>

    <div class="step" id="step3">
      <h2 class="text-lg font-semibold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h2>
      <div class="grid grid-cols-2 gap-3">
        <input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="border p-2 rounded">
        <input id="phone_alt" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á" class="border p-2 rounded">
        <select id="member_status" class="border p-2 rounded" required>
          <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
          <option>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
          <option>‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
          <option>‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
        </select>
        <select id="marital_status" class="border p-2 rounded" required>
          <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏£‡∏™</option>
          <option>‡πÇ‡∏™‡∏î</option>
          <option>‡∏´‡∏°‡πâ‡∏≤‡∏¢</option>
          <option>‡∏´‡∏¢‡πà‡∏≤</option>
        </select>
        <input id="spouse_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" class="border p-2 rounded">
        <label><input type="checkbox" id="is_rubber_member"> ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Å‡∏¢‡∏ó</label>
        <input id="rubber_member_id" placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Å‡∏¢‡∏ó" class="border p-2 rounded">
        <input id="father_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏¥‡∏î‡∏≤" class="border p-2 rounded">
        <input id="mother_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏£‡∏î‡∏≤" class="border p-2 rounded">
      </div>
      <div class="flex justify-between mt-3">
        <button type="button" id="back2" class="btn btn-edit">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button type="submit" class="btn btn-add">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </div>
    </div>
  </form>

  <!-- üßæ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
  <h2 class="text-lg font-semibold mt-6 mb-2">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
  <table id="memberTable">
    <thead>
      <tr>
        <th>‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
        <th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
        <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
        <th>‡∏•‡∏ö</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  const SUPABASE_URL = "https://ttottijljxoinptmhgtu.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y"; // üëâ ‡πÉ‡∏™‡πà anon key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  const EDGE_URL = `https://ttottijljxoinptmhgtu.supabase.co/functions/v1/members`;

  const steps = document.querySelectorAll('.step');
  let currentStep = 0;
  document.getElementById('next1').onclick = () => showStep(1);
  document.getElementById('next2').onclick = () => showStep(2);
  document.getElementById('back1').onclick = () => showStep(0);
  document.getElementById('back2').onclick = () => showStep(1);
  function showStep(i){ steps.forEach((s, idx)=>s.classList.toggle('active', idx===i)); }

  async function loadMembers(){
    const res = await fetch(EDGE_URL, { headers: { apikey: SUPABASE_KEY, Authorization: `Bearer ${SUPABASE_KEY}` } });
    const data = await res.json();
    const tbody = document.querySelector("#memberTable tbody");
    tbody.innerHTML = "";
    data.forEach(m => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${m.member_id}</td>
        <td>${m.first_name}</td>
        <td>${m.last_name}</td>
        <td>${m.group}</td>
        <td>${m.province}</td>
        <td>${m.member_status}</td>
        <td><button class="btn btn-edit" onclick='editMember("${m.member_id}")'>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
        <td><button class="btn btn-del" onclick='deleteMember("${m.member_id}")'>‡∏•‡∏ö</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  document.getElementById('memberForm').onsubmit = async (e)=>{
    e.preventDefault();
    const formData = Object.fromEntries(new FormData(e.target));
    const res = await fetch(EDGE_URL, {
      method: "POST",
      headers: { "Content-Type":"application/json", apikey: SUPABASE_KEY, Authorization:`Bearer ${SUPABASE_KEY}` },
      body: JSON.stringify(formData)
    });
    const data = await res.json();
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    e.target.reset();
    showStep(0);
    loadMembers();
  }

  async function deleteMember(id){
    if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){
      await fetch(`${EDGE_URL}?id=${id}`, {
        method:"DELETE",
        headers:{ apikey: SUPABASE_KEY, Authorization:`Bearer ${SUPABASE_KEY}` }
      });
      loadMembers();
    }
  }

  async function editMember(id){
    alert("‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤");
  }

  loadMembers();
  </script>

</body>
</html>
