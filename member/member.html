<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
*{ box-sizing:border-box; }

body {
  font-family:"Prompt",sans-serif;
  background:#f0f4f8;
  margin:20px;
  color:#333;
  line-height:1.5;
}

h2 { text-align:center; color:#1e40af; margin-bottom:15px; }

form { max-width:950px; margin:auto; }

.form-step {
  display:none;
  background:#fff;
  padding:20px 25px;
  border-radius:12px;
  box-shadow:0 5px 20px rgba(0,0,0,0.08);
  margin-bottom:20px;
}
.form-step.active { display:block; }

input, select {
  display:block;
  width:48%;
  margin:5px 1% 10px 1%;
  padding:8px 10px;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:14px;
  background:#f9fafb;
  transition:0.2s;
}
input:focus, select:focus {
  outline:none;
  border-color:#4a90e2;
  box-shadow:0 0 5px rgba(74,144,226,0.3);
  background:#fff;
}

label{ font-size:13px; margin-right:8px; display:inline-block; }
small{ font-size:12px; color:#555; }

.form-navigation {
  text-align:center;
  margin-top:15px;
}
.form-navigation button {
  padding:8px 14px;
  margin:3px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#4a90e2;
  color:#fff;
  transition:0.2s;
}
.form-navigation button:hover { background:#357abd; }

table {
  border-collapse: collapse;
  width:100%;
  max-width:1000px;
  margin:auto;
  font-size:13px;
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
th, td { border:1px solid #e2e8f0; padding:6px 8px; text-align:center; white-space:nowrap; }
th { background:#4a90e2; color:#fff; cursor:pointer; position:relative; font-weight:500; }
th span.sort-icon { position:absolute; right:6px; font-size:12px; }
tr:nth-child(even){ background:#f9fafb; }
tr:hover{ background:#edf2f7; }

button.edit, button.delete {
  padding:4px 8px;
  border-radius:4px;
  font-size:12px;
  color:#fff;
  border:none;
  cursor:pointer;
}
button.edit{ background:#4a90e2; }
button.edit:hover{ background:#357abd; }
button.delete{ background:#f56565; }
button.delete:hover{ background:#c53030; }

.pagination {
  text-align:center;
  margin:15px auto;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:6px;
}
.pagination button {
  padding:6px 12px;
  border:none;
  border-radius:5px;
  background:#4a90e2;
  color:#fff;
  cursor:pointer;
  font-size:13px;
}
.pagination button:hover{ background:#357abd; }

.progress-container {
  display:flex;
  justify-content:space-between;
  align-items:center;
  max-width:950px;
  margin:0 auto 20px auto;
  position:relative;
}
.progress-step {
  position:relative;
  background:#f9fafb;
  color:#4a5568;
  border:2px solid #cbd5e0;
  border-radius:50px;
  padding:8px 15px;
  font-size:13px;
  flex:1;
  text-align:center;
  margin:0 4px;
  transition:all 0.3s;
}
.progress-step.active {
  background:#4a90e2;
  color:#fff;
  border-color:#4a90e2;
}

/* ‚úÖ Dashboard Summary */
.summary-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  max-width: 950px;
  margin: 20px auto;
}
.summary-card {
  background: #ffffff;
  flex: 1 1 160px;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  text-align: center;
  transition: 0.2s;
}
.summary-card:hover { transform: translateY(-3px); }
.summary-card h3 { margin: 0; font-size: 16px; color: #334155; }
.summary-card p { margin: 5px 0 0 0; font-size: 22px; font-weight: 600; color: #1e3a8a; }
.summary-card.total { border-top: 4px solid #2563eb; }
.summary-card.male { border-top: 4px solid #0ea5e9; }
.summary-card.female { border-top: 4px solid #f472b6; }
.summary-card.exit { border-top: 4px solid #f59e0b; }
.summary-card.death { border-top: 4px solid #ef4444; }

/* ‚úÖ ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
@media (max-width: 768px) {
  .summary-container { flex-direction: column; align-items: stretch; gap: 10px; }
  input, select { width:100%!important; }
}
</style>
</head>
<body>

<h2>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<div class="progress-container">
  <div class="progress-step active" data-step="1">‚ë† ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
  <div class="progress-step" data-step="2">‚ë° ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</div>
  <div class="progress-step" data-step="3">‚ë¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
</div>

<form id="memberForm">
  <div class="form-step active">
    <h3>Step 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
    <input placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" name="member_id" required>
    <input type="date" name="join_date" required>
    <input placeholder="‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤" name="title" required>
    <input placeholder="‡∏ä‡∏∑‡πà‡∏≠" name="first_name" required>
    <input placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" name="last_name" required>
    <input placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (x-xxxx-xxxxx-xx-x)" name="id_card" maxlength="17" required>
    <input type="date" name="birthday" id="birthday" required>
    <input placeholder="‡∏≠‡∏≤‡∏¢‡∏∏" name="age" id="age" readonly>
    <select name="gender" required>
      <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏®--</option><option>‡∏ä‡∏≤‡∏¢</option><option>‡∏´‡∏ç‡∏¥‡∏á</option>
    </select>
    <select name="group" required>
      <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°--</option><option>1</option><option>2</option><option>3</option>
    </select>
  </div>

  <div class="form-step">
    <h3>Step 2: ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</h3>
    <input placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" name="house_no" required>
    <input placeholder="‡∏ï‡∏≥‡∏ö‡∏•" name="subdistrict" required>
    <input placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠" name="district" required>
    <input placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" name="province" required>
    <input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" name="phone">
  </div>

  <div class="form-step">
    <h3>Step 3: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
    <select name="member_status" required>
      <option value="">--‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>
      <option>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
      <option>‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
      <option>‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
    </select>
    <input placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™" name="spouse_name">
  </div>

  <div class="form-navigation">
    <button type="button" id="prevBtn">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <button type="button" id="nextBtn">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    <button type="submit" id="submitBtn" style="display:none;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>
</form>

<!-- ‚úÖ Dashboard -->
<div class="summary-container">
  <div class="summary-card total"><h3>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><p id="sumTotal">0</p></div>
  <div class="summary-card male"><h3>‡∏ä‡∏≤‡∏¢</h3><p id="sumMale">0</p></div>
  <div class="summary-card female"><h3>‡∏´‡∏ç‡∏¥‡∏á</h3><p id="sumFemale">0</p></div>
  <div class="summary-card exit"><h3>‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</h3><p id="sumExit">0</p></div>
  <div class="summary-card death"><h3>‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</h3><p id="sumDeath">0</p></div>
</div>

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<table id="memberTable">
  <thead>
    <tr>
      <th>‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th><th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th><th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="pagination">
  <button id="prevPage">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
  <span id="pageInfo">‡∏´‡∏ô‡πâ‡∏≤ 1</span>
  <button id="nextPage">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
</div>

<script>
const API_URL='https://ttottijljxoinptmhgtu.supabase.co/functions/v1/members';
const form=document.getElementById('memberForm');
const formSteps=document.querySelectorAll('.form-step');
const progressSteps=document.querySelectorAll('.progress-step');
let formStepIndex=0;
let allMembers=[], currentPage=1, rowsPerPage=10;

function showStep(n){
  formSteps.forEach((s,i)=>s.classList.toggle('active',i===n));
  progressSteps.forEach((p,i)=>p.classList.toggle('active',i<=n));
  document.getElementById('prevBtn').style.display=n===0?'none':'inline-block';
  document.getElementById('nextBtn').style.display=n===formSteps.length-1?'none':'inline-block';
  document.getElementById('submitBtn').style.display=n===formSteps.length-1?'inline-block':'none';
}

document.getElementById('nextBtn').onclick=()=>{ if(validateStep(formStepIndex)) showStep(++formStepIndex); };
document.getElementById('prevBtn').onclick=()=>{ showStep(--formStepIndex); };

function validateStep(n){
  const inputs=formSteps[n].querySelectorAll('input,select');
  for(let inp of inputs){ if(inp.required && !inp.value){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); return false; } }
  return true;
}

/* ‚úÖ ‡∏≠‡∏≤‡∏¢‡∏∏ */
document.getElementById('birthday').onchange=function(){
  if(this.value){
    const b=new Date(this.value),t=new Date();
    let a=t.getFullYear()-b.getFullYear();
    if(t.getMonth()<b.getMonth()||(t.getMonth()==b.getMonth()&&t.getDate()<b.getDate()))a--;
    document.getElementById('age').value=a;
  }
};

/* ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å */
form.onsubmit=async e=>{
  e.preventDefault();
  const data=Object.fromEntries(new FormData(form));
  try{
    await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    form.reset(); formStepIndex=0; showStep(0); loadMembers();
  }catch(err){alert(err);}
};

/* ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
async function loadMembers(){
  try{
    const res=await fetch(API_URL);
    const r=await res.json();
    allMembers=Array.isArray(r)?r:(r.data||[]);
    renderTable(); updateSummary();
  }catch(e){alert(e);}
}

/* ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
function renderTable(){
  const tbody=document.querySelector('#memberTable tbody');
  tbody.innerHTML='';
  allMembers.forEach(m=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${m.member_id||''}</td><td>${m.first_name||''}</td><td>${m.last_name||''}</td><td>${m.group||''}</td><td>${m.province||''}</td><td>${m.member_status||''}</td>
    <td><button class="edit" onclick="editMember('${m.member_id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
    <td><button class="delete" onclick="deleteMember('${m.member_id}')">‡∏•‡∏ö</button></td>`;
    tbody.appendChild(tr);
  });
}

/* ‚úÖ Dashboard */
function updateSummary(){
  document.getElementById('sumTotal').textContent=allMembers.length;
  document.getElementById('sumMale').textContent=allMembers.filter(x=>x.gender==='‡∏ä‡∏≤‡∏¢').length;
  document.getElementById('sumFemale').textContent=allMembers.filter(x=>x.gender==='‡∏´‡∏ç‡∏¥‡∏á').length;
  document.getElementById('sumExit').textContent=allMembers.filter(x=>x.member_status==='‡∏•‡∏≤‡∏≠‡∏≠‡∏Å').length;
  document.getElementById('sumDeath').textContent=allMembers.filter(x=>x.member_status==='‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï').length;
}

/* ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö */
window.editMember=id=>{
  const m=allMembers.find(x=>x.member_id===id);
  if(!m)return;
  for(let k in m){ if(form.elements[k]) form.elements[k].value=m[k]; }
  formStepIndex=0; showStep(0);
};
window.deleteMember=async id=>{
  if(!confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?'))return;
  await fetch(API_URL+'/'+id,{method:'DELETE'});
  loadMembers();
};

loadMembers(); showStep(0);
</script>

</body>
</html>
