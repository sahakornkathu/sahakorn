<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
<style>
/* (‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏¢‡∏≤‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö) */
@import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
body { font-family:"Prompt",sans-serif; background:#f0f4f8; margin:20px; color:#333; }
h2 { text-align:center; color:#1e40af; margin-bottom:15px; }
form { max-width:950px; margin:auto; }
.form-step { display:none; background:#fff; padding:20px 25px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.08); margin-bottom:20px; }
.form-step.active { display:block; }
input, select { display:block; width:48%; margin:5px 1% 10px 1%; padding:6px 10px; border:1px solid #ccc; border-radius:6px; font-size:14px; background:#f9fafb; }
input:focus, select:focus { outline:none; border-color:#4a90e2; box-shadow:0 0 5px rgba(74,144,226,0.3); background:#fff; }
label{ font-size:13px; margin-right:8px; display:inline-block; }
small{ font-size:12px; color:#555; }
.form-navigation { text-align:center; margin-top:15px; }
.form-navigation button { padding:6px 12px; margin:3px; border:none; border-radius:6px; cursor:pointer; background:#4a90e2; color:#fff; }
.form-navigation button:hover { background:#357abd; }
#filterDiv { background:#fff; padding:12px 15px; border-radius:10px; max-width:950px; margin:25px auto 15px; box-shadow:0 4px 12px rgba(0,0,0,0.08); display:flex; flex-wrap:wrap; gap:6px; align-items:center; }
#filterDiv input, #filterDiv select { padding:5px 8px; border:1px solid #ccc; border-radius:6px; font-size:13px; flex:1 1 150px; }
#filterDiv label { font-size:13px; color:#1e40af; margin:0 3px; }
table { border-collapse: collapse; width:100%; max-width:1000px; margin:auto; font-size:13px; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
th, td { border:1px solid #e2e8f0; padding:6px 8px; text-align:center; }
th { background:#4a90e2; color:#fff; cursor:pointer; position:relative; font-weight:500; }
th span.sort-icon { position:absolute; right:6px; font-size:12px; }
tr:nth-child(even){ background:#f9fafb; }
tr:hover{ background:#edf2f7; }
button.edit { background:#4a90e2; color:#fff; padding:3px 6px; border-radius:4px; font-size:12px; }
button.edit:hover { background:#357abd; }
button.delete { background:#f56565; color:#fff; padding:3px 6px; border-radius:4px; font-size:12px; }
button.delete:hover { background:#c53030; }
.pagination { text-align:center; margin:12px auto; display:flex; flex-wrap:wrap; justify-content:center; gap:6px; }
.pagination button { padding:5px 10px; margin:3px; border:none; border-radius:5px; background:#4a90e2; color:#fff; cursor:pointer; font-size:13px; }
.pagination button:hover{ background:#357abd; }
#pageInfo, #resultCount{ font-weight:500; color:#2d3748; font-size:13px; }
.progress-container { display:flex; justify-content:space-between; align-items:center; max-width:950px; margin:0 auto 20px auto; position:relative; counter-reset: step; }
.progress-container::before { content:""; position:absolute; top:50%; left:0; width:100%; height:3px; background-color:#e2e8f0; transform:translateY(-50%); z-index:0; }
.progress-step { position:relative; z-index:1; background:#f9fafb; color:#4a5568; border:2px solid #cbd5e0; border-radius:50px; padding:8px 15px; font-size:13px; font-weight:500; flex:1; text-align:center; margin:0 4px; transition:all 0.3s; white-space:nowrap; }
.progress-step.active { background:#4a90e2; color:#fff; border-color:#4a90e2; box-shadow:0 0 8px rgba(74,144,226,0.5); }
@media (max-width:768px){
  body{ margin:10px; font-size:14px; }
  form{ width:100%; padding:10px; }
  .form-step{ padding:10px; }
  input, select{ width:100% !important; margin:6px 0 12px 0; font-size:15px; }
  label{ margin-top:10px; font-size:14px; }
  small{ font-size:12px; }
  .form-navigation{ display:flex; flex-direction:column; gap:10px; }
  .form-navigation button{ width:100%; padding:12px; font-size:15px; }
  table{ display:block; width:100%; overflow-x:auto; font-size:13px; }
  th, td{ white-space:nowrap; padding:8px 10px; }
  .progress-container{ flex-direction:column; align-items:flex-start; gap:8px; }
  .progress-container::before{ display:none; }
  .progress-step{ width:100%; text-align:left; padding:10px 15px; border-radius:10px; font-size:14px; }
}

/* Filter Section */
#filterDiv {
    background: #ffffff;
    padding: 15px 20px;
    border-radius: 10px;
    max-width: 950px;
    margin: 20px auto;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    justify-content: flex-start;
}
#filterDiv label {
    font-size: 14px;
    color: #1e40af;
    font-weight: 500;
    margin-right: 5px;
}
#filterDiv input,
#filterDiv select {
    padding: 6px 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    background: #f9fafb;
    flex: 1 1 180px;
    transition: 0.2s;
}
#filterDiv input:focus,
#filterDiv select:focus {
    border-color: #4a90e2;
    box-shadow: 0 0 5px rgba(74,144,226,0.3);
    background: #fff;
}
#filterDiv button {
    background: #4a90e2;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 14px;
    transition: 0.2s;
}
#filterDiv button:hover {
    background: #357abd;
}
#resultCount {
    font-size: 14px;
    font-weight: 500;
    color: #2d3748;
    margin-left: 10px;
}
.date-filter {
    display: flex;
    align-items: center;
    gap: 5px;
    flex: 1 1 280px;
}
.bottom-filters {
  display: flex;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap;
  justify-content: space-between;
  margin-top: 10px;
  width: 100%;
}
.bottom-filters select {
  flex: 1 1 200px;
}
.buttons-group {
  display: flex;
  gap: 10px;
}
@media (max-width:768px){
    #filterDiv{ flex-direction: column; align-items:flex-start; }
    .date-filter{ flex-direction: column; align-items:flex-start; gap:5px; }
    .bottom-filters{ flex-direction: column; align-items:flex-start; gap:8px; }
    .buttons-group{ width: 100%; justify-content: flex-start; }
    .bottom-filters select{ width:100%; }
}


  /* ‚úÖ Dashboard Style */
#dashboard {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  max-width: 950px;
  margin: 25px auto;
}
#dashboard .card {
  flex: 1 1 200px;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  padding: 20px;
  text-align: center;
  font-size: 15px;
  font-weight: 500;
  color: #1e3a8a;
  transition: transform 0.2s, box-shadow 0.2s;
}
#dashboard .card span {
  display: block;
  font-size: 26px;
  font-weight: 700;
  color: #111827;
  margin-top: 5px;
}
#dashboard .card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}
#dashboard .total { border-top: 4px solid #4a90e2; }
#dashboard .active { border-top: 4px solid #10b981; }
#dashboard .exit { border-top: 4px solid #f59e0b; }
#dashboard .dead { border-top: 4px solid #ef4444; }

@media (max-width:768px){
  #dashboard { flex-direction: column; align-items: stretch; gap: 12px; }
  #dashboard .card { font-size: 16px; padding: 16px; }
  #dashboard .card span { font-size: 28px; }
}
</style>
</head>
<body>

<!-- ‚úÖ Dashboard Section -->
<div id="dashboard">
  <div class="card total">üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î<br><span id="totalMembers">0</span></div>
  <div class="card active">‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å<br><span id="activeMembers">0</span></div>
  <div class="card exit">üìÑ ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å<br><span id="exitMembers">0</span></div>
  <div class="card dead">‚ö∞Ô∏è ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï<br><span id="deadMembers">0</span></div>
</div>

  
<h2>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<div class="progress-container">
  <div class="progress-step active" data-step="1">‚ë† ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
  <div class="progress-step" data-step="2">‚ë° ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</div>
  <div class="progress-step" data-step="3">‚ë¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
</div>

<form id="memberForm">
  <div class="form-step active">
    <h3>Step 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
    <input placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" name="member_id" required="">
    <small>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</small>
    <input type="date" name="join_date" required="">
    <input placeholder="‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤" name="title" required="">
    <input placeholder="‡∏ä‡∏∑‡πà‡∏≠" name="first_name" required="">
    <input placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" name="last_name" required="">
    <input placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (x-xxxx-xxxxx-xx-x)" name="id_card" required="" maxlength="17">
    <small>üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</small>
    <input type="date" name="birthday" id="birthday" required="">
    <input placeholder="‡∏≠‡∏≤‡∏¢‡∏∏" name="age" id="age" readonly="">
    <select name="gender" required="">
      <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏®--</option>
      <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
      <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
      <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
    </select>
    <select name="group" required="">
      <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°--</option>
      <option value="1">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 1</option>
      <option value="2">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 2</option>
      <option value="3">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 3</option>
      <option value="4">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 4</option>
      <option value="5">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 5</option>
      <option value="6">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 6</option>
      <option value="7">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 7</option>
      <option value="8">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 8</option>
      <option value="9">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 9</option>
    </select>
  </div>

  <div class="form-step">
    <h3>Step 2: ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</h3>
    <input placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" name="house_no" required="">
    <input placeholder="‡∏´‡∏°‡∏π‡πà" name="moo">
    <input placeholder="‡∏ñ‡∏ô‡∏ô" name="street" required="">
    <input placeholder="‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô" name="village">
    <input placeholder="‡∏ï‡∏≥‡∏ö‡∏•" name="subdistrict" required="">
    <input placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠" name="district" required="">
    <input placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" name="province" required="">
    <input placeholder="‡πÄ‡∏•‡∏Ç‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" name="postal_code" required="">
    <input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" name="phone">
    <input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á" name="phone_alt">
  </div>

  <div class="form-step">
    <h3>Step 3: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
    <select name="member_status" required="">
      <option value="">--‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>
      <option value="‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
      <option value="‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
      <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
    </select>
    <select name="marital_status" required="">
      <option value="">--‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏£‡∏™--</option>
      <option value="‡πÇ‡∏™‡∏î">‡πÇ‡∏™‡∏î</option>
      <option value="‡∏™‡∏°‡∏£‡∏™">‡∏™‡∏°‡∏£‡∏™</option>
      <option value="‡∏´‡∏°‡πâ‡∏≤‡∏¢">‡∏´‡∏°‡πâ‡∏≤‡∏¢</option>
      <option value="‡∏´‡∏¢‡πà‡∏≤">‡∏´‡∏¢‡πà‡∏≤</option>
    </select>
    <input placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™" name="spouse_name">
    <label style="display:block;margin:8px 0;"><input type="checkbox" name="kyot_member"> ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Å‡∏¢‡∏ó</label>
    <input placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Å‡∏¢‡∏ó" name="kyot_member_id">
    <input placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏¥‡∏î‡∏≤" name="father_name">
    <input placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏£‡∏î‡∏≤" name="mother_name">
  </div>

  <div class="form-navigation">
    <button type="button" id="prevBtn" style="display: none;">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <button type="button" id="nextBtn" style="display: inline-block;">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    <button type="submit" id="submitBtn" style="display:none;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>
</form>

<h2>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<div id="filterDiv">
  <input id="searchMemberId" placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">
  <input id="searchName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ / ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
  <input id="searchGroup" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°">
  <input id="searchProvince" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
  <div class="date-filter">
    <label>‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
    <input type="date" id="searchJoinDateStart">
    <label>‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
    <input type="date" id="searchJoinDateEnd">
  </div>
  <div class="bottom-filters">
  <select id="searchStatus">
    <option value="">--‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>
    <option value="‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
    <option value="‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
    <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
  </select>
  <select id="searchGender">
    <option value="">--‡πÄ‡∏û‡∏®--</option>
    <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
    <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
  </select>
    <div class="buttons-group">
      <button id="printReport">üñ®Ô∏è ‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
      <button id="clearFilter">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
    </div>
  </div>
  <span id="resultCount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
</div>

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<table id="memberTable">
  <thead>
    <tr>
      <th data-column="member_id">‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span class="sort-icon"></span></th>
      <th data-column="first_name">‡∏ä‡∏∑‡πà‡∏≠ <span class="sort-icon"></span></th>
      <th data-column="last_name">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="sort-icon"></span></th>
      <th data-column="group">‡∏Å‡∏•‡∏∏‡πà‡∏° <span class="sort-icon"></span></th>
      <th data-column="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span class="sort-icon"></span></th>
      <th data-column="member_status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <span class="sort-icon"></span></th>
      <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
      <th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody>
    <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
  </tbody>
</table>

<div class="pagination">
  <button id="prevPage">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
  <span id="pageInfo">‡∏´‡∏ô‡πâ‡∏≤ 1</span>
  <button id="nextPage">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
</div>

<script>
const API_URL='https://ttottijljxoinptmhgtu.supabase.co/functions/v1/members';
const form=document.getElementById('memberForm');
const tableBody=document.querySelector('#memberTable tbody');
let editId=null;
let allMembers=[];
let sortColumn=null, sortAsc=true;
let currentPage=1, rowsPerPage=10;

// Multi-step form
const formSteps=document.querySelectorAll('.form-step');
const progressSteps=document.querySelectorAll('.progress-step');
let formStepIndex=0;
showStep(formStepIndex);

document.getElementById('nextBtn').addEventListener('click',()=>{ 
  if(!validateStep(formStepIndex)) return; 
  formStepIndex++; showStep(formStepIndex); 
});
document.getElementById('prevBtn').addEventListener('click',()=>{ 
  formStepIndex--; showStep(formStepIndex); 
});

function showStep(n){
  formSteps.forEach((step,i)=>step.classList.remove('active'));
  formSteps[n].classList.add('active');
  progressSteps.forEach((p,i)=>p.classList.toggle('active',i<=n));
  document.getElementById('prevBtn').style.display=n===0?'none':'inline-block';
  document.getElementById('nextBtn').style.display=n===formSteps.length-1?'none':'inline-block';
  document.getElementById('submitBtn').style.display=n===formSteps.length-1?'inline-block':'none';
}

function validateStep(n){
  const inputs=formSteps[n].querySelectorAll('input,select');
  for(let inp of inputs){
    if(inp.hasAttribute('required') && !inp.value){
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + (inp.placeholder || inp.name));
      inp.focus();
      return false;
    }
  }
  return true;
}

// ‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î
document.getElementById('birthday').addEventListener('change', function(){
  if(!this.value){ document.getElementById('age').value=''; return; }
  const birthDate = new Date(this.value);
  const today = new Date();
  let age = today.getFullYear() - birthDate.getFullYear();
  const m = today.getMonth() - birthDate.getMonth();
  if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
  document.getElementById('age').value = age >= 0 ? age : '';
});

// --- ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡πÅ‡∏ö‡πà‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1000 ‡πÅ‡∏ñ‡∏ß)
async function loadMembers(){
  try{
    let allData=[];
    let from=0;
    const chunk=1000;
    while(true){
      const res=await fetch(`${API_URL}?range_start=${from}`);
      const result=await res.json();
      if(result.error){ alert(result.error); break; }
      const data=result.data||[];
      if(data.length===0) break;
      allData=allData.concat(data);
      if(data.length<chunk) break;
      from+=chunk;
    }
    allMembers=allData;
    renderTable();
  }catch(err){ alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+err); }
}

// --- ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
function renderTable(){
  let rows = allMembers.slice();
  const startDate = document.getElementById('searchJoinDateStart').value ? new Date(document.getElementById('searchJoinDateStart').value) : null;
  const endDate = document.getElementById('searchJoinDateEnd').value ? new Date(document.getElementById('searchJoinDateEnd').value) : null;
  const memberId=document.getElementById('searchMemberId').value.trim();
  const name=document.getElementById('searchName').value.trim().toLowerCase();
  const group=document.getElementById('searchGroup').value.trim();
  const province=document.getElementById('searchProvince').value.trim().toLowerCase();
  const status=document.getElementById('searchStatus').value;
  const gender=document.getElementById('searchGender').value;

  rows=rows.filter(m=>{
    if(memberId && !(m.member_id || '').includes(memberId)) return false;
    if(name && !(((m.first_name||'') + (m.last_name||'')).toLowerCase().includes(name))) return false;
    if(group && (m.group || '').toString() != group) return false;
    if(province && !((m.province||'').toLowerCase().includes(province))) return false;
    if(status && (m.member_status || '') != status) return false;
    if(gender && (m.gender || '') != gender) return false;
    if(startDate && new Date(m.join_date) < startDate) return false;
    if(endDate && new Date(m.join_date) > endDate) return false;
    return true;
  });

  if(sortColumn) rows.sort((a,b)=>{
    const aa=(a[sortColumn]||'').toString().toLowerCase();
    const bb=(b[sortColumn]||'').toString().toLowerCase();
    return sortAsc ? (aa>bb?1:-1) : (aa<bb?1:-1);
  });

  const start=(currentPage-1)*rowsPerPage;
  const end=start+rowsPerPage;
  const pageRows=rows.slice(start,end);
  tableBody.innerHTML='';
  pageRows.forEach(m=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${m.member_id||''}</td>
      <td>${m.first_name||''}</td>
      <td>${m.last_name||''}</td>
      <td>${m.group||''}</td>
      <td>${m.province||''}</td>
      <td>${m.member_status||''}</td>
      <td><button class="edit" onclick="editMember('${m.member_id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
      <td><button class="delete" onclick="deleteMember('${m.member_id}')">‡∏•‡∏ö</button></td>`;
    tableBody.appendChild(tr);
  });
  document.getElementById('pageInfo').textContent=`‡∏´‡∏ô‡πâ‡∏≤ ${currentPage}`;
  document.getElementById('resultCount').textContent=`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${rows.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
}

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
window.editMember = (id) => {
  const m = allMembers.find(x => x.member_id === id);
  if (!m) return;
  editId = id;

  for (let k in m) {
    if (!form.elements[k]) continue;
    let val = m[k];

    if (typeof val === "string" && val.match(/^\d{4}\/\d{2}\/\d{2}$/)) val = val.replaceAll("/", "-");
    if (typeof val === "string" && val.includes("T")) val = val.split("T")[0];

    form.elements[k].value = val;
  }

  // ‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î
  const birthdayInput = form.elements["birthday"];
  const ageInput = form.elements["age"];
  if (birthdayInput && birthdayInput.value) {
    const birthDate = new Date(birthdayInput.value);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const mDiff = today.getMonth() - birthDate.getMonth();
    if (mDiff < 0 || (mDiff === 0 && today.getDate() < birthDate.getDate())) age--;
    ageInput.value = age >= 0 ? age : "";
  } else {
    ageInput.value = "";
  }

  formStepIndex = 0;
  showStep(0);
};

// ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
form.addEventListener('submit', async(e)=>{
  e.preventDefault();
  const data=Object.fromEntries(new FormData(form));

  // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
  if (data.join_date) data.join_date = data.join_date.replaceAll("/", "-");
  if (data.birthday) data.birthday = data.birthday.replaceAll("/", "-");

  // ‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î
  if (data.birthday) {
    const birthDate = new Date(data.birthday);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
    data.age = age >= 0 ? age : null;
  } else {
    data.age = null;
  }

  const idCardRaw = data.id_card.replace(/\D/g, '');
  data.id_card = idCardRaw;
  if(editId) data.member_id=editId;

  try{
    const res=await fetch(API_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    const result=await res.json();
    if(result.error){ alert(result.error); return; }
    alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    form.reset(); editId=null; formStepIndex=0; showStep(0); await loadMembers();
  }catch(err){ alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+err); }
});

// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
window.deleteMember=async(id)=>{
  if(!confirm('‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ?')) return;
  try{
    await fetch(API_URL+'/'+id,{method:'DELETE'});
    allMembers=allMembers.filter(m=>m.member_id!==id);
    renderTable();
  }catch(err){ alert(err); }
};

// ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á, ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á, ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
document.getElementById('prevPage').addEventListener('click',()=>{ if(currentPage>1){ currentPage--; renderTable(); } });
document.getElementById('nextPage').addEventListener('click',()=>{ currentPage++; renderTable(); });
document.querySelectorAll('#memberTable th[data-column]').forEach(th=>{
  th.addEventListener('click',()=>{
    const col=th.getAttribute('data-column');
    if(sortColumn===col) sortAsc=!sortAsc; else { sortColumn=col; sortAsc=true; }
    renderTable();
  });
});
['searchMemberId','searchName','searchGroup','searchProvince','searchStatus','searchGender','searchJoinDateStart','searchJoinDateEnd']
.forEach(id=>document.getElementById(id).addEventListener('input',()=>{ currentPage=1; renderTable(); }));

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
loadMembers();
</script>

</body>
</html>
