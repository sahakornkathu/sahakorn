<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: sans-serif; padding: 20px }
    table { border-collapse: collapse; width: 100%; margin-top: 20px }
    th, td { border: 1px solid #ccc; padding: 8px }
    button { margin: 2px }
  </style>
</head>
<body>

<h2>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>

<form id="memberForm">
  <input type="hidden" id="id">

  <input placeholder="‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤" id="prefix">
  <input placeholder="‡∏ä‡∏∑‡πà‡∏≠" id="name" required>
  <input placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" id="lastname" required>
  <input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" id="phone">

  <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <button type="button" onclick="resetForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</form>

<table>
  <thead>
    <tr>
      <th>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠</th>
      <th>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
      <th>‡πÇ‡∏ó‡∏£</th>
      <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
    </tr>
  </thead>
  <tbody id="memberTable"></tbody>
</table>

<script>
const supabaseUrl = 'https://ttottijljxoinptmhgtu.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y'
const supabase = supabase.createClient(supabaseUrl, supabaseKey)

const form = document.getElementById('memberForm')
const table = document.getElementById('memberTable')

form.addEventListener('submit', saveMember)

// ================== LOAD ==================
async function loadMembers() {
  const { data } = await supabase
    .from('members')
    .select('*')
    .order('created_at', { ascending: false })

  table.innerHTML = ''
  data.forEach(m => {
    table.innerHTML += `
      <tr>
        <td>${m.prefix || ''}</td>
        <td>${m.name}</td>
        <td>${m.lastname}</td>
        <td>${m.phone || ''}</td>
        <td>
          <button onclick='editMember(${JSON.stringify(m)})'>‚úèÔ∏è</button>
          <button onclick="deleteMember('${m.id}')">üóë</button>
        </td>
      </tr>
    `
  })
}

// ================== SAVE / UPDATE ==================
async function saveMember(e) {
  e.preventDefault()

  const id = document.getElementById('id').value
  const data = {
    prefix: prefix.value,
    name: name.value,
    lastname: lastname.value,
    phone: phone.value
  }

  if (id) {
    await supabase.from('members').update(data).eq('id', id)
  } else {
    await supabase.from('members').insert([data])
  }

  resetForm()
  loadMembers()
}

// ================== EDIT ==================
function editMember(m) {
  id.value = m.id
  prefix.value = m.prefix || ''
  name.value = m.name
  lastname.value = m.lastname
  phone.value = m.phone || ''
}

// ================== DELETE ==================
async function deleteMember(id) {
  if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return
  await supabase.from('members').delete().eq('id', id)
  loadMembers()
}

// ================== RESET ==================
function resetForm() {
  form.reset()
  id.value = ''
}

loadMembers()
</script>

</body>
</html>
