<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-100 p-6">

<div class="max-w-7xl mx-auto space-y-6">

  <!-- Header -->
  <div class="bg-white rounded-xl shadow p-6">
    <h1 class="text-2xl font-bold text-gray-800">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
    <p class="text-sm text-gray-500">‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
  </div>

  <!-- Form -->
  <div class="bg-white rounded-xl shadow p-6">
    <form id="memberForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">

      <input type="number" id="member_id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å *"
        class="input" required>

      <input type="date" id="join_date" class="input">

      <input id="title" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤" class="input">

      <input id="first_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠ *" class="input" required>

      <input id="last_name" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *" class="input" required>

      <input id="id_card" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô" class="input">

      <input type="date" id="birthday" class="input">

      <input id="group" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°" class="input">

      <input id="house_no" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" class="input">

      <input id="moo" placeholder="‡∏´‡∏°‡∏π‡πà" class="input">

      <input id="street" placeholder="‡∏ñ‡∏ô‡∏ô" class="input">

      <input id="village" placeholder="‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô" class="input">

      <input id="subdistrict" placeholder="‡∏ï‡∏≥‡∏ö‡∏•" class="input">

      <input id="district" placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠" class="input">

      <input id="province" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" class="input">

      <input id="postal_code" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" class="input">

      <input id="phone" placeholder="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="input">

      <input id="phone_alt" placeholder="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á" class="input">

      <select id="member_status" class="input">
        <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
        <option value="active">‡∏õ‡∏Å‡∏ï‡∏¥</option>
        <option value="inactive">‡∏û‡πâ‡∏ô‡∏™‡∏†‡∏≤‡∏û</option>
      </select>

      <select id="marital_status" class="input">
        <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û</option>
        <option value="single">‡πÇ‡∏™‡∏î</option>
        <option value="married">‡∏™‡∏°‡∏£‡∏™</option>
      </select>

      <input id="spouse_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™" class="input">

      <div class="md:col-span-3 flex gap-3 pt-4">
        <button type="submit"
          class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
          üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </button>
        <button type="button" onclick="resetForm()"
          class="bg-gray-300 px-6 py-2 rounded-lg hover:bg-gray-400">
          ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </button>
      </div>

    </form>
  </div>

  <!-- Table -->
  <div class="bg-white rounded-xl shadow p-6 overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™</th>
          <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="px-4 py-2 text-left">‡πÇ‡∏ó‡∏£</th>
          <th class="px-4 py-2 text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="px-4 py-2 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="rows" class="divide-y"></tbody>
    </table>
  </div>

</div>

<!-- Supabase -->
<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const SUPABASE_URL = 'https://ttottijljxoinptmhgtu.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y'
const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

const form = document.getElementById('memberForm')
const rows = document.getElementById('rows')

async function loadMembers() {
  const { data } = await db.from('members').select('*').order('member_id')
  rows.innerHTML = ''
  data.forEach(m => {
    rows.innerHTML += `
      <tr class="hover:bg-gray-50">
        <td class="px-4 py-2">${m.member_id}</td>
        <td class="px-4 py-2">${m.first_name} ${m.last_name}</td>
        <td class="px-4 py-2">${m.phone ?? ''}</td>
        <td class="px-4 py-2">${m.member_status ?? ''}</td>
        <td class="px-4 py-2 text-center space-x-2">
          <button onclick='editMember(${JSON.stringify(m)})'
            class="px-3 py-1 bg-yellow-400 rounded hover:bg-yellow-500">‚úèÔ∏è</button>
          <button onclick="deleteMember(${m.member_id})"
            class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">üóë</button>
        </td>
      </tr>`
  })
}

form.addEventListener('submit', async e => {
  e.preventDefault()
  const data = Object.fromEntries(
    [...form.elements].filter(el => el.id).map(el => [el.id, el.value || null])
  )
  await db.from('members').upsert([data], { onConflict: 'member_id' })
  resetForm()
  loadMembers()
})

window.editMember = m => {
  member_id.value = m.member_id
  member_id.disabled = true
  for (const k in m) if (document.getElementById(k)) document.getElementById(k).value = m[k] ?? ''
}

window.deleteMember = async id => {
  if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?')) return
  await db.from('members').delete().eq('member_id', id)
  loadMembers()
}

window.resetForm = () => {
  form.reset()
  member_id.disabled = false
}

loadMembers()
</script>

<style>
.input {
  @apply border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400;
}
</style>

</body>
</html>
