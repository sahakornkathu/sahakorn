<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
body { font-family:"Prompt",sans-serif; background:#f0f4f8; margin:20px; color:#333; }
h2 { text-align:center; color:#1e40af; margin-bottom:15px; }
form { max-width:950px; margin:auto; }
.form-step { display:none; background:#fff; padding:20px 25px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.08); margin-bottom:20px; }
.form-step.active { display:block; }
input, select { display:block; width:48%; margin:5px 1% 10px 1%; padding:6px 10px; border:1px solid #ccc; border-radius:6px; font-size:14px; background:#f9fafb; }
input:focus, select:focus { outline:none; border-color:#4a90e2; box-shadow:0 0 5px rgba(74,144,226,0.3); background:#fff; }
label{ font-size:13px; margin-right:8px; display:inline-block; }
small{ font-size:12px; color:#555; }
.form-navigation { text-align:center; margin-top:15px; }
.form-navigation button { padding:6px 12px; margin:3px; border:none; border-radius:6px; cursor:pointer; background:#4a90e2; color:#fff; }
.form-navigation button:hover { background:#357abd; }
#filterDiv { background:#fff; padding:12px 15px; border-radius:10px; max-width:950px; margin:25px auto 15px; box-shadow:0 4px 12px rgba(0,0,0,0.08); display:flex; flex-wrap:wrap; gap:6px; align-items:center; }
#filterDiv input, #filterDiv select { padding:5px 8px; border:1px solid #ccc; border-radius:6px; font-size:13px; background:#f9fafb; flex:1 1 150px; }
#filterDiv label { font-size:13px; color:#1e40af; margin:0 3px; }
table { border-collapse: collapse; width:100%; max-width:1000px; margin:auto; font-size:13px; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
th, td { border:1px solid #e2e8f0; padding:6px 8px; text-align:center; }
th { background:#4a90e2; color:#fff; cursor:pointer; position:relative; font-weight:500; }
th span.sort-icon { position:absolute; right:6px; font-size:12px; }
tr:nth-child(even){ background:#f9fafb; }
tr:hover{ background:#edf2f7; }
button.edit { background:#4a90e2; color:#fff; padding:3px 6px; border-radius:4px; font-size:12px; }
button.edit:hover { background:#357abd; }
button.delete { background:#f56565; color:#fff; padding:3px 6px; border-radius:4px; font-size:12px; }
button.delete:hover { background:#c53030; }
.pagination { text-align:center; margin:12px auto; display:flex; flex-wrap:wrap; justify-content:center; gap:6px; }
.pagination button { padding:5px 10px; margin:3px; border:none; border-radius:5px; background:#4a90e2; color:#fff; cursor:pointer; font-size:13px; }
.pagination button:hover{ background:#357abd; }
#pageInfo, #resultCount{ font-weight:500; color:#2d3748; font-size:13px; }
</style>
</head>
<body>

<h2>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>

<!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) -->
<form id="memberForm"> ... (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ... </form>

<h2>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<div id="filterDiv">
  <input id="searchMemberId" placeholder="‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">
  <input id="searchName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ / ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
  <input id="searchGroup" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°">
  <input id="searchProvince" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">

  <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
  <label>‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
  <input type="date" id="searchJoinDateStart">
  <label>‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
  <input type="date" id="searchJoinDateEnd">

  <button id="printReport">üñ®Ô∏è ‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
  <select id="searchStatus">
    <option value="">--‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>
    <option value="‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
    <option value="‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
    <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
  </select>
  <select id="searchGender">
    <option value="">--‡πÄ‡∏û‡∏®--</option>
    <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
    <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
  </select>
  <span id="resultCount"></span>
</div>

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<table id="memberTable">
  <thead>
    <tr>
      <th data-column="member_id">‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span class="sort-icon"></span></th>
      <th data-column="first_name">‡∏ä‡∏∑‡πà‡∏≠ <span class="sort-icon"></span></th>
      <th data-column="last_name">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="sort-icon"></span></th>
      <th data-column="group">‡∏Å‡∏•‡∏∏‡πà‡∏° <span class="sort-icon"></span></th>
      <th data-column="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span class="sort-icon"></span></th>
      <th data-column="member_status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <span class="sort-icon"></span></th>
      <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
      <th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="pagination">
  <button id="prevPage">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
  <span id="pageInfo"></span>
  <button id="nextPage">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
</div>

<script>
const API_URL='https://ttottijljxoinptmhgtu.supabase.co/functions/v1/members';
const form=document.getElementById('memberForm');
const tableBody=document.querySelector('#memberTable tbody');
let editId=null;
let allMembers=[];
let sortColumn=null, sortAsc=true;
let currentPage=1, rowsPerPage=10;

// --- Load Members ---
async function loadMembers(){
  try{
    const res=await fetch(API_URL);
    const result=await res.json();
    if(result.error){ alert(result.error); return; }
    if(!Array.isArray(result.data)){ alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); return; }
    allMembers=result.data; filterMembers();
  }catch(err){ alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+err); }
}

// --- Render Table ---
function renderTable(members){
  tableBody.innerHTML='';
  const start=(currentPage-1)*rowsPerPage;
  const end=start+rowsPerPage;
  const paginated=members.slice(start,end);
  paginated.forEach(m=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${m.member_id}</td>
      <td>${m.first_name}</td>
      <td>${m.last_name}</td>
      <td>${m.group}</td>
      <td>${m.province}</td>
      <td>${m.member_status}</td>
      <td><button class="edit" onclick="editMember('${m.member_id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
      <td><button class="delete" onclick="deleteMember('${m.member_id}')">‡∏•‡∏ö</button></td>
    `;
    tableBody.appendChild(tr);
  });
  const totalPages=Math.ceil(members.length/rowsPerPage);
  document.getElementById('pageInfo').textContent=`‡∏´‡∏ô‡πâ‡∏≤ ${currentPage} ‡∏à‡∏≤‡∏Å ${totalPages}`;
  document.getElementById('resultCount').textContent=`‡∏û‡∏ö ${members.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
}

// --- Filter ---
function filterMembers(){
  const idFilter=document.getElementById('searchMemberId').value.toLowerCase();
  const nameFilter=document.getElementById('searchName').value.toLowerCase();
  const groupFilter=document.getElementById('searchGroup').value.toLowerCase();
  const provinceFilter=document.getElementById('searchProvince').value.toLowerCase();
  const statusFilter=document.getElementById('searchStatus').value;
  const genderFilter=document.getElementById('searchGender').value;
  const joinDateStart=document.getElementById('searchJoinDateStart').value;
  const joinDateEnd=document.getElementById('searchJoinDateEnd').value;

  let filtered=allMembers.filter(m=>{
    const joinDate = m.join_date ? m.join_date.split('T')[0] : '';
    return (!idFilter||m.member_id.toLowerCase().includes(idFilter)) &&
           (!nameFilter||(m.first_name.toLowerCase().includes(nameFilter)||m.last_name.toLowerCase().includes(nameFilter))) &&
           (!groupFilter||(m.group&&m.group.toLowerCase().includes(groupFilter))) &&
           (!provinceFilter||(m.province&&m.province.toLowerCase().includes(provinceFilter))) &&
           (!statusFilter||m.member_status===statusFilter) &&
           (!genderFilter||m.gender===genderFilter) &&
           (!joinDateStart || joinDate >= joinDateStart) &&
           (!joinDateEnd || joinDate <= joinDateEnd);
  });

  if(sortColumn){
    filtered.sort((a,b)=>{
      let valA=a[sortColumn]||'', valB=b[sortColumn]||'';
      valA=valA.toString().toLowerCase(); valB=valB.toString().toLowerCase();
      if(valA<valB) return sortAsc?-1:1;
      if(valA>valB) return sortAsc?1:-1;
      return 0;
    });
  }
  renderTable(filtered);
}

// --- Pagination ---
document.getElementById('prevPage').addEventListener('click',()=>{ if(currentPage>1){ currentPage--; filterMembers(); } });
document.getElementById('nextPage').addEventListener('click',()=>{ const totalPages=Math.ceil(allMembers.length/rowsPerPage); if(currentPage<totalPages){ currentPage++; filterMembers(); } });

// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° event ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢
['searchMemberId','searchName','searchGroup','searchProvince','searchStatus','searchGender','searchJoinDateStart','searchJoinDateEnd']
.forEach(id=>document.getElementById(id).addEventListener('input',()=>{ currentPage=1; filterMembers(); }));

loadMembers();
</script>
</body>
</html>
