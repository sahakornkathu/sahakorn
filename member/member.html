<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
  <style>
    body { font-family:sans-serif; background:#f3f4f6; padding:20px }
    form, table { background:#fff; padding:15px; border-radius:6px }
    input { padding:6px; margin:4px }
    table { width:100%; border-collapse:collapse; margin-top:20px }
    th, td { border:1px solid #ddd; padding:8px }
  </style>
</head>
<body>

<h2>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>

<form id="memberForm">
  <input type="hidden" id="id">
  <input id="prefix" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤">
  <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required>
  <input id="lastname" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
  <input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
  <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <button type="button" onclick="resetForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</form>

<table>
  <thead>
    <tr>
      <th>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠</th>
      <th>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
      <th>‡πÇ‡∏ó‡∏£</th>
      <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
    </tr>
  </thead>
  <tbody id="memberTable"></tbody>
</table>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

  const SUPABASE_URL = 'https://ttottijljxoinptmhgtu.supabase.co'
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y'

  const db = createClient(SUPABASE_URL, SUPABASE_KEY)

  const form = document.getElementById('memberForm')
  const table = document.getElementById('memberTable')

  async function loadMembers() {
    const { data } = await db.from('members').select('*').order('created_at', { ascending:false })
    table.innerHTML = ''
    data.forEach(m => {
      table.innerHTML += `
        <tr>
          <td>${m.prefix || ''}</td>
          <td>${m.name}</td>
          <td>${m.lastname}</td>
          <td>${m.phone || ''}</td>
          <td>
            <button onclick='editMember(${JSON.stringify(m)})'>‚úèÔ∏è</button>
            <button onclick="deleteMember('${m.id}')">üóë</button>
          </td>
        </tr>
      `
    })
  }

  form.addEventListener('submit', async e => {
    e.preventDefault()
    const id = document.getElementById('id').value

    const data = {
      prefix: prefix.value,
      name: name.value,
      lastname: lastname.value,
      phone: phone.value
    }

    if (id) {
      await db.from('members').update(data).eq('id', id)
    } else {
      await db.from('members').insert([data])
    }

    resetForm()
    loadMembers()
  })

  window.editMember = m => {
    id.value = m.id
    prefix.value = m.prefix || ''
    name.value = m.name
    lastname.value = m.lastname
    phone.value = m.phone || ''
  }

  window.deleteMember = async id => {
    if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return
    await db.from('members').delete().eq('id', id)
    loadMembers()
  }

  window.resetForm = () => {
    form.reset()
    document.getElementById('id').value = ''
  }

  loadMembers()
</script>

</body>
</html>
