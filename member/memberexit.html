<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å/‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï + Dashboard + ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ‚úÖ Navbar Style */
#navbar {
  background: #4a90e2;
  color: white;
  padding: 10px 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}
.nav-container {
  max-width: 1000px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}
.nav-logo {
  font-weight: 600;
  font-size: 18px;
  letter-spacing: 0.5px;
}
.nav-links {
  list-style: none;
  display: flex;
  gap: 15px;
  margin: 0;
  padding: 0;
}
.nav-links li a {
  color: white;
  text-decoration: none;
  font-weight: 400;
  padding: 6px 12px;
  border-radius: 6px;
  transition: background 0.2s;
}
.nav-links li a:hover {
  background: rgba(255,255,255,0.2);
}
.nav-links li a.active {
  background: white;
  color: #4a90e2;
  font-weight: 500;
}
@media (max-width:768px) {
  .nav-container { flex-direction: column; align-items: flex-start; gap: 10px; }
  .nav-links { flex-direction: column; width: 100%; }
  .nav-links li a { display: block; width: 100%; }
}

  </style>
</head>
<body class="bg-gray-100 font-sans">
<!-- ‚úÖ Navbar -->
<nav id="navbar">
  <div class="nav-container">
    <div class="nav-logo">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
    <ul class="nav-links">
      <li><a href="member.html">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a></li>
      <li><a href="memberexit.html"  class="active">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</a></li>
      <li><a href="welfare.html">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a></li>
    </ul>
  </div>
</nav>

<div class="container mx-auto p-6">
  <h1 class="text-2xl font-bold mb-6">üìå ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å/‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï + Dashboard + ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h1>

  <!-- Dashboard -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-xl font-semibold mb-4">üìä Dashboard</h2>
    <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 mb-4">
      <input type="date" id="startDate" class="border rounded p-2 flex-1">
      <input type="date" id="endDate" class="border rounded p-2 flex-1">
      <button onclick="loadDashboard()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 w-full sm:w-auto">üîÑ ‡πÇ‡∏´‡∏•‡∏î</button>
    </div>
    <div class="grid grid-cols-2 gap-4 sm:gap-6 mb-4">
      <div class="bg-gray-100 p-4 rounded shadow text-center">
        <h2 class="text-lg font-semibold">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</h2>
        <p id="countResign" class="text-2xl sm:text-3xl font-bold mt-2">0</p>
      </div>
      <div class="bg-gray-100 p-4 rounded shadow text-center">
        <h2 class="text-lg font-semibold">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</h2>
        <p id="countDeceased" class="text-2xl sm:text-3xl font-bold mt-2">0</p>
      </div>
    </div>
    <div class="bg-white p-2 sm:p-4 rounded shadow">
      <canvas id="statusChart"></canvas>
    </div>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
  <div class="overflow-x-auto mb-6">
    <table class="min-w-full bg-white shadow rounded">
      <thead class="bg-indigo-600 text-white">
        <tr>
          <th class="p-3">‡∏£‡∏´‡∏±‡∏™</th>
          <th class="p-3">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
          <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="p-3">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="p-3">‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
          <th class="p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</th>
          <th class="p-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th class="p-3">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
        </tr>
      </thead>
      <tbody id="memberBody" class="divide-y"></tbody>
    </table>
  </div>

  <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ -->
  <h2 class="text-xl font-semibold mb-2">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>

  <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå -->
  <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 mb-2">
    <input type="date" id="printStartDate" class="border rounded p-2 flex-1">
    <input type="date" id="printEndDate" class="border rounded p-2 flex-1">
    <select id="printStatus" class="border rounded p-2 flex-1">
      <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      <option value="‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option>
      <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
    </select>
    <select id="printGroup" class="border rounded p-2 flex-1">
      <option value="">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    </select>
    <button onclick="loadHistory()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded w-full sm:w-auto">üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button onclick="printReport()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded w-full sm:w-auto">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå HTML</button>
  </div>

  <!-- ‚úÖ ‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
  <div class="flex flex-col sm:flex-row justify-between items-center mb-2 text-gray-700">
    <p id="recordCount" class="font-semibold">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
    <p id="totalAmount" class="font-semibold text-green-700">üí∞ ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 0 ‡∏ö‡∏≤‡∏ó</p>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full bg-white shadow rounded">
      <thead class="bg-gray-700 text-white">
        <tr>
          <th class="p-3">‡∏£‡∏´‡∏±‡∏™</th>
          <th class="p-3">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
          <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="p-3">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="p-3">‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
          <th class="p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</th>
          <th class="p-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
        </tr>
      </thead>
      <tbody id="historyBody" class="divide-y"></tbody>
    </table>
  </div>
</div>

<script>
const SUPABASE_URL="https://ttottijljxoinptmhgtu.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y";
const client=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let chart=null;

// ========== LOAD MEMBERS ==========
async function loadMembers(){
  const { data } = await client.from('members')
    .select('member_id, title, first_name, last_name, group, member_status')
    .in('member_status',['‡∏•‡∏≤‡∏≠‡∏≠‡∏Å','‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï']);
  const tbody=document.getElementById('memberBody');
  tbody.innerHTML='';
  data.forEach(m=>{
    tbody.innerHTML+=`
    <tr class="hover:bg-gray-100">
      <td class="p-2">${m.member_id}</td>
      <td class="p-2">${m.title||''}</td>
      <td class="p-2">${m.first_name}</td>
      <td class="p-2">${m.last_name}</td>
      <td class="p-2">${m.group}</td>
      <td class="p-2">${m.member_status}</td>
      <td class="p-2"><input type="date" id="meeting_date_${m.member_id}" class="border rounded p-1 w-full"></td>
      <td class="p-2"><input type="number" id="share_amount_${m.member_id}" class="border rounded p-1 w-full"></td>
      <td class="p-2"><input type="date" id="receive_date_${m.member_id}" class="border rounded p-1 w-full"></td>
      <td class="p-2"><button onclick="saveMemberExit('${m.member_id}','${m.first_name}','${m.last_name}','${m.group}','${m.member_status}','${m.title||''}')" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></td>
    </tr>`;
  });
  populateGroupFilter(); // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
}

// ========== SAVE MEMBER EXIT ==========
async function saveMemberExit(member_id,first_name,last_name,group,member_status,title){
  const meeting_date=document.getElementById(`meeting_date_${member_id}`).value;
  const share_amount=document.getElementById(`share_amount_${member_id}`).value;
  const receive_date=document.getElementById(`receive_date_${member_id}`).value;
  if(!meeting_date||!share_amount||!receive_date){alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');return;}
  const {error}=await client.from('member_exit').insert([{member_id,title,first_name,last_name,group,member_status,meeting_date,share_amount,receive_date}]);
  if(error){alert(error.message);return;}
  alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${title}${first_name} ${last_name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
  loadHistory();
}

// ========== HISTORY ==========
async function loadHistory(){
  const start=document.getElementById('printStartDate').value;
  const end=document.getElementById('printEndDate').value;
  const status=document.getElementById('printStatus').value;
  const group=document.getElementById('printGroup').value;

  let query=client.from('member_exit').select('*').order('receive_date',{ascending:false});
  if(start)query=query.gte('receive_date',start);
  if(end)query=query.lte('receive_date',end);
  if(status)query=query.eq('member_status',status);
  if(group)query=query.eq('group',group);

  const {data,error}=await query;
  if(error){console.error(error);return;}

  // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  document.getElementById('recordCount').innerText = `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

  // ‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
  const total = data.reduce((sum, i) => sum + (parseFloat(i.share_amount) || 0), 0);
  document.getElementById('totalAmount').innerText = `üí∞ ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;

  const tbody=document.getElementById('historyBody');
  tbody.innerHTML='';
  data.forEach(i=>{
    tbody.innerHTML+=`
    <tr class="hover:bg-gray-100">
      <td class="p-2">${i.member_id}</td>
      <td class="p-2">${i.title||''}</td>
      <td class="p-2">${i.first_name}</td>
      <td class="p-2">${i.last_name}</td>
      <td class="p-2">${i.group}</td>
      <td class="p-2">${i.member_status}</td>
      <td class="p-2">${i.meeting_date||''}</td>
      <td class="p-2 text-right">${i.share_amount?Number(i.share_amount).toLocaleString():""}</td>
      <td class="p-2">${i.receive_date||''}</td>
    </tr>`;
  });
}

// ========== DASHBOARD ==========
async function loadDashboard(){
  const start=document.getElementById('startDate').value;
  const end=document.getElementById('endDate').value;
  let query=client.from('member_exit').select('member_status,receive_date');
  if(start)query=query.gte('receive_date',start);
  if(end)query=query.lte('receive_date',end);
  const {data,error}=await query;
  if(error){alert(error.message);return;}
  const resign=data.filter(d=>d.member_status==='‡∏•‡∏≤‡∏≠‡∏≠‡∏Å').length;
  const dead=data.filter(d=>d.member_status==='‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï').length;
  document.getElementById('countResign').innerText=resign;
  document.getElementById('countDeceased').innerText=dead;
  const ctx=document.getElementById('statusChart').getContext('2d');
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:'bar',data:{labels:['‡∏•‡∏≤‡∏≠‡∏≠‡∏Å','‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï'],datasets:[{data:[resign,dead],backgroundColor:['#3B82F6','#EF4444']}]},options:{plugins:{legend:{display:false}}}});
}

// ========== PRINT ==========
async function printReport(){
  const start=document.getElementById('printStartDate').value;
  const end=document.getElementById('printEndDate').value;
  const status=document.getElementById('printStatus').value;
  const group=document.getElementById('printGroup').value;
  const logoUrl='https://lh5.googleusercontent.com/d/1B0sZdUz54kO4zAv0oJgoN4Aipy3UyCyR';
  let query=client.from('member_exit').select('*').order('receive_date',{ascending:false});
  if(start)query=query.gte('receive_date',start);
  if(end)query=query.lte('receive_date',end);
  if(status)query=query.eq('member_status',status);
  if(group)query=query.eq('group',group);
  const {data,error}=await query;
  if(error){alert(error.message);return;}

  const total = data.reduce((sum, i) => sum + (parseFloat(i.share_amount) || 0), 0);

  let html=`<html><head><title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å/‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</title>
  <style>body{font-family:Arial;padding:20px;}table{width:100%;border-collapse:collapse;}th,td{border:1px solid #000;padding:8px;}th{background:#eee;}</style>
  </head><body>
  <img src="${logoUrl}" width="70"><h1 style="text-align:center;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å/‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</h1>
  <p style="text-align:center;">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${start||'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'} ‡∏ñ‡∏∂‡∏á ${end||'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'} | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${status||'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'} | ‡∏Å‡∏•‡∏∏‡πà‡∏°: ${group||'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'}</p>
  <p style="text-align:right;">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | üí∞ ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
  <table><thead><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th></tr></thead><tbody>`;
  data.forEach(i=>{
    html+=`<tr><td>${i.member_id}</td><td>${i.title||''}${i.first_name} ${i.last_name}</td><td>${i.group}</td><td>${i.member_status}</td><td>${i.meeting_date}</td><td>${Number(i.share_amount||0).toLocaleString()}</td><td>${i.receive_date}</td></tr>`;
  });
  html+=`</tbody></table></body></html>`;
  const w=window.open('','_blank');w.document.write(html);w.document.close();w.print();
}

// ========== ‡πÄ‡∏ï‡∏¥‡∏° Dropdown ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ==========
async function populateGroupFilter(){
  const groupSelect=document.getElementById('printGroup');
  const { data, error } = await client.from('members').select('group');
  if(error){console.error(error);return;}
  const groups=[...new Set(data.map(i=>i.group).filter(Boolean))];
  groupSelect.innerHTML='<option value="">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
  groups.forEach(g=>{
    const opt=document.createElement('option');
    opt.value=g; opt.textContent=g;
    groupSelect.appendChild(opt);
  });
}

// ========== INIT ==========
loadMembers();
loadHistory();
</script>
</body>
</html>
