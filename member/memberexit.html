<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å/‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï + Dashboard + ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">

<div class="container mx-auto p-6">
  <h1 class="text-2xl font-bold mb-6">üìå ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å/‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï + Dashboard + ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h1>

  <!-- Dashboard -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-xl font-semibold mb-4">üìä Dashboard</h2>
    <div class="flex gap-4 mb-4">
      <input type="date" id="startDate" class="border rounded p-2">
      <input type="date" id="endDate" class="border rounded p-2">
      <button onclick="loadDashboard()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">üîÑ ‡πÇ‡∏´‡∏•‡∏î</button>
    </div>
    <div class="grid grid-cols-2 gap-6 mb-6">
      <div class="bg-gray-100 p-4 rounded shadow text-center">
        <h2 class="text-lg font-semibold">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</h2>
        <p id="countResign" class="text-3xl font-bold mt-2">0</p>
      </div>
      <div class="bg-gray-100 p-4 rounded shadow text-center">
        <h2 class="text-lg font-semibold">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</h2>
        <p id="countDeceased" class="text-3xl font-bold mt-2">0</p>
      </div>
    </div>
    <div class="bg-white p-4 rounded shadow">
      <canvas id="statusChart"></canvas>
    </div>
  </div>

  <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
  <div class="mb-4">
    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å..." 
      onkeyup="filterMembers()" 
      class="w-full p-2 border rounded shadow focus:outline-none focus:ring-2 focus:ring-indigo-400" />
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
  <div class="overflow-x-auto mb-2">
    <table class="min-w-full bg-white shadow rounded">
      <thead class="bg-indigo-600 text-white">
        <tr>
          <th class="p-3">‡∏£‡∏´‡∏±‡∏™</th>
          <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="p-3">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="p-3">‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
          <th class="p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</th>
          <th class="p-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th class="p-3">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
        </tr>
      </thead>
      <tbody id="memberBody" class="divide-y"></tbody>
    </table>
  </div>

  <!-- Pagination ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
  <div class="flex justify-between my-4">
    <button id="prevPageMembers" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <span id="pageInfoMembers" class="font-semibold"></span>
    <button id="nextPageMembers" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
  </div>

  <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ -->
  <h2 class="text-xl font-semibold mb-2">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>

  <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå -->
  <div class="flex gap-4 mb-2">
    <input type="date" id="printStartDate" class="border rounded p-2">
    <input type="date" id="printEndDate" class="border rounded p-2">
    <button onclick="printReport()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå HTML</button>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full bg-white shadow rounded">
      <thead class="bg-gray-700 text-white">
        <tr>
          <th class="p-3">‡∏£‡∏´‡∏±‡∏™</th>
          <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="p-3">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="p-3">‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
          <th class="p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</th>
          <th class="p-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th class="p-3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="historyBody" class="divide-y"></tbody>
    </table>
  </div>

  <!-- Pagination ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ -->
  <div class="flex justify-between my-4">
    <button id="prevPageHistory" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <span id="pageInfoHistory" class="font-semibold"></span>
    <button id="nextPageHistory" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
  </div>

</div>

<script>
const SUPABASE_URL = "https://ttottijljxoinptmhgtu.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let chart = null;
let currentPageMembers = 1, pageSizeMembers = 10, memberData=[];
let currentPageHistory = 1, pageSizeHistory = 10, historyData=[];

// ==================== MEMBERS ====================
async function loadMembers(page = 1){
  const { data: exitedData } = await client.from('member_exit').select('member_id');
  const exitedIds = exitedData.map(e => e.member_id);
  const from = (page-1)*pageSizeMembers;
  const to = page*pageSizeMembers-1;

  const { data, error, count } = await client.from('members')
    .select('member_id, first_name, last_name, group, member_status', {count:'exact'})
    .in('member_status', ['‡∏•‡∏≤‡∏≠‡∏≠‡∏Å','‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï'])
    .range(from,to);
  if(error){console.error(error); return;}
  memberData = data;
  renderMemberTable(data, exitedIds);

  const totalPages = Math.ceil(count/pageSizeMembers);
  document.getElementById('pageInfoMembers').innerText = `‡∏´‡∏ô‡πâ‡∏≤ ${page} / ${totalPages}`;
  document.getElementById('prevPageMembers').disabled = page===1;
  document.getElementById('nextPageMembers').disabled = page===totalPages;
}

function renderMemberTable(data, exitedIds){
  const tbody = document.getElementById('memberBody');
  tbody.innerHTML='';
  data.forEach(m=>{
    const isExited = exitedIds.includes(m.member_id);
    const row = document.createElement('tr');
    row.className = isExited ? "bg-gray-200" : "hover:bg-gray-100";
    row.innerHTML = `
      <td class="p-2">${m.member_id}</td>
      <td class="p-2">${m.first_name}</td>
      <td class="p-2">${m.last_name}</td>
      <td class="p-2">${m.group}</td>
      <td class="p-2">${m.member_status}</td>
      <td class="p-2"><input type="date" id="meeting_date_${m.member_id}" class="border rounded p-1 w-full" ${isExited?'disabled':''}></td>
      <td class="p-2"><input type="number" id="share_amount_${m.member_id}" class="border rounded p-1 w-full" ${isExited?'disabled':''}></td>
      <td class="p-2"><input type="date" id="receive_date_${m.member_id}" class="border rounded p-1 w-full" ${isExited?'disabled':''}></td>
      <td class="p-2">
        <button onclick="saveMemberExit('${m.member_id}','${m.first_name}','${m.last_name}','${m.group}','${m.member_status}')"
          class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded" ${isExited?'disabled':''}>üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </td>`;
    tbody.appendChild(row);
  });
}

function filterMembers(){
  const q = document.getElementById('searchInput').value.toLowerCase();
  renderMemberTable(memberData.filter(m=>
    m.first_name.toLowerCase().includes(q)||
    m.last_name.toLowerCase().includes(q)||
    m.member_id.toLowerCase().includes(q)
  ));
}

async function saveMemberExit(member_id, first_name, last_name, group, member_status){
  const meeting_date = document.getElementById(`meeting_date_${member_id}`).value;
  const share_amount = document.getElementById(`share_amount_${member_id}`).value;
  const receive_date = document.getElementById(`receive_date_${member_id}`).value;
  if(!meeting_date || !share_amount || !receive_date){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); return;}
  const {error} = await client.from('member_exit').insert([{member_id, first_name, last_name, group, member_status, meeting_date, share_amount, receive_date}]);
  if(error){ alert(error.message); return;}
  alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${first_name} ${last_name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
  loadMembers(currentPageMembers);
  loadHistory(currentPageHistory);
}

// ==================== HISTORY ====================
async function loadHistory(page=1){
  const from = (page-1)*pageSizeHistory;
  const to = page*pageSizeHistory-1;
  const { data, error, count } = await client.from('member_exit')
    .select('*',{count:'exact'})
    .order('receive_date',{ascending:false})
    .range(from,to);
  if(error){ console.error(error); return;}
  historyData = data;
  renderHistoryTable(data);
  const totalPages = Math.ceil(count/pageSizeHistory);
  document.getElementById('pageInfoHistory').innerText = `‡∏´‡∏ô‡πâ‡∏≤ ${page} / ${totalPages}`;
  document.getElementById('prevPageHistory').disabled = page===1;
  document.getElementById('nextPageHistory').disabled = page===totalPages;
}

function renderHistoryTable(data){
  const tbody = document.getElementById('historyBody');
  tbody.innerHTML='';
  data.forEach(item=>{
    const row = document.createElement('tr');
    row.className="hover:bg-gray-100 transition";
    row.innerHTML = `
      <td class="p-2">${item.member_id}</td>
      <td class="p-2"><input type="text" id="edit_fname_${item.member_id}" value="${item.first_name}" class="border rounded p-1 w-full"></td>
      <td class="p-2"><input type="text" id="edit_lname_${item.member_id}" value="${item.last_name}" class="border rounded p-1 w-full"></td>
      <td class="p-2"><input type="text" id="edit_group_${item.member_id}" value="${item.group}" class="border rounded p-1 w-full"></td>
      <td class="p-2">${item.member_status}</td>
      <td class="p-2"><input type="date" id="edit_meeting_${item.member_id}" value="${item.meeting_date}" class="border rounded p-1 w-full"></td>
      <td class="p-2"><input type="number" id="edit_share_${item.member_id}" value="${item.share_amount}" class="border rounded p-1 w-full"></td>
      <td class="p-2"><input type="date" id="edit_receive_${item.member_id}" value="${item.receive_date}" class="border rounded p-1 w-full"></td>
      <td class="p-2">
        <button onclick="updateHistory('${item.member_id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded mb-1">üíæ Save</button>
        <button onclick="deleteHistory('${item.member_id}')" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">üóëÔ∏è Delete</button>
      </td>`;
    tbody.appendChild(row);
  });
}

async function updateHistory(member_id){
  const updated={
    first_name: document.getElementById(`edit_fname_${member_id}`).value,
    last_name: document.getElementById(`edit_lname_${member_id}`).value,
    group: document.getElementById(`edit_group_${member_id}`).value,
    meeting_date: document.getElementById(`edit_meeting_${member_id}`).value,
    share_amount: document.getElementById(`edit_share_${member_id}`).value,
    receive_date: document.getElementById(`edit_receive_${member_id}`).value
  };
  const {error} = await client.from('member_exit').update(updated).eq('member_id',member_id);
  if(error){alert(error.message); return;}
  alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
  loadHistory(currentPageHistory);
}

async function deleteHistory(member_id){
  if(!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
  const {error} = await client.from('member_exit').delete().eq('member_id',member_id);
  if(error){alert(error.message); return;}
  alert('‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
  loadMembers(currentPageMembers);
  loadHistory(currentPageHistory);
}

// ==================== DASHBOARD ====================
async function loadDashboard(){
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;

  // ‚úÖ ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ chain ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  let query = client.from('member_exit').select('member_id, member_status, receive_date', { count: 'exact' });
  if (startDate && endDate) {
    query = query.gte('receive_date', startDate).lte('receive_date', endDate);
  } else if (startDate) {
    query = query.gte('receive_date', startDate);
  } else if (endDate) {
    query = query.lte('receive_date', endDate);
  }

  const { data, error } = await query;
  if (error) { alert(error.message); return; }

  const countResign = data.filter(d => d.member_status === '‡∏•‡∏≤‡∏≠‡∏≠‡∏Å').length;
  const countDeceased = data.filter(d => d.member_status === '‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï').length;

  document.getElementById('countResign').innerText = countResign;
  document.getElementById('countDeceased').innerText = countDeceased;

  const ctx = document.getElementById('statusChart').getContext('2d');
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['‡∏•‡∏≤‡∏≠‡∏≠‡∏Å', '‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï'],
      datasets: [{
        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
        data: [countResign, countDeceased],
        backgroundColor: ['#3B82F6', '#EF4444']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: true, text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞' }
      },
      scales: {
        y: { beginAtZero: true, precision: 0 }
      }
    }
  });
}


// ==================== PRINT HTML ====================
async function printReport(){
  const startDate = document.getElementById('printStartDate').value;
  const endDate = document.getElementById('printEndDate').value;
  const logoUrl = 'https://your-logo-url.com/logo.png'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

  let query = client.from('member_exit').select('*').order('receive_date',{ascending:false});
  if(startDate) query = query.gte('receive_date',startDate);
  if(endDate) query = query.lte('receive_date',endDate);
  const {data,error} = await query;
  if(error){alert(error.message); return;}

  let html = `<html><head><title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å/‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</title>
  <style>
    body{font-family:Arial,sans-serif;padding:20px;}
    table{width:100%;border-collapse:collapse;margin-top:20px;}
    th,td{border:1px solid #000;padding:8px;text-align:left;}
    th{background-color:#f0f0f0;}
    h1{text-align:center;margin:5px 0;}
    .logo{display:block;margin:0 auto 5px auto;width:60px;height:auto;}
    @media print{
      body{margin:10mm;}
      table{page-break-inside:auto;}
      tr{page-break-inside:avoid; page-break-after:auto;}
      thead{display:table-header-group;}
      tfoot{display:table-footer-group;}
    }
  </style>
  </head><body>
  <img src="${logoUrl}" class="logo">
  <h1>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏≤‡∏≠‡∏≠‡∏Å / ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</h1>
  <p style="text-align:center;">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${startDate||'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'} ‡∏ñ‡∏∂‡∏á ${endDate||'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'}</p>
  <table>
  <thead><tr>
    <th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
  </tr></thead><tbody>`;

  data.forEach(item=>{
    html+=`<tr>
      <td>${item.member_id}</td>
      <td>${item.first_name}</td>
      <td>${item.last_name}</td>
      <td>${item.group}</td>
      <td>${item.member_status}</td>
      <td>${item.meeting_date}</td>
      <td>${item.share_amount}</td>
      <td>${item.receive_date}</td>
    </tr>`;
  });

  html+=`</tbody></table></body></html>`;

  const w = window.open('','_blank');
  w.document.write(html);
  w.document.close();
  w.focus();
  w.print();
}

// ==================== INIT ====================
loadMembers(currentPageMembers);
loadHistory(currentPageHistory);

document.getElementById('prevPageMembers').onclick=()=>{ if(currentPageMembers>1){ currentPageMembers--; loadMembers(currentPageMembers); } };
document.getElementById('nextPageMembers').onclick=()=>{ currentPageMembers++; loadMembers(currentPageMembers); };
document.getElementById('prevPageHistory').onclick=()=>{ if(currentPageHistory>1){ currentPageHistory--; loadHistory(currentPageHistory); } };
document.getElementById('nextPageHistory').onclick=()=>{ currentPageHistory++; loadHistory(currentPageHistory); };
</script>

</body>
</html>
