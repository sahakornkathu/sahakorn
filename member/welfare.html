<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
body { font-family:"Prompt",sans-serif; background:#f0f4f8; margin:20px; color:#333; }
h2 { text-align:center; color:#1e40af; margin-bottom:15px; }
form { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.08); }
input, select, button { display:block; width:100%; margin:8px 0; padding:8px 10px; border:1px solid #ccc; border-radius:6px; font-size:14px; }
input:focus, select:focus { outline:none; border-color:#4a90e2; box-shadow:0 0 5px rgba(74,144,226,0.3); background:#fff; }
button { background:#4a90e2; color:#fff; border:none; cursor:pointer; transition:0.2s; }
button:hover { background:#357abd; }
table { border-collapse:collapse; width:95%; max-width:1000px; margin:20px auto; font-size:13px; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08);}
th, td { border:1px solid #e2e8f0; padding:6px 8px; text-align:center; }
th { background:#4a90e2; color:#fff; font-weight:500; }
tr:nth-child(even){ background:#f9fafb; }
tr:hover{ background:#edf2f7; }
.edit, .delete { padding:4px 8px; border-radius:4px; font-size:12px; color:#fff; border:none; cursor:pointer; }
.edit { background:#4a90e2; }
.edit:hover { background:#357abd; }
.delete { background:#f56565; }
.delete:hover { background:#c53030; }
</style>
</head>
<body>

<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>

<form id="welfareForm">
  <select id="memberSelect" required>
    <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>
  </select>
  <input type="date" id="receive_date" required placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô">
  <input type="number" id="amount" required placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
  <select id="note" required>
    <option value="">--‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•--</option>
    <option value="‡∏û‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏û‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
    <option value="‡πÅ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÅ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
    <option value="‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
  </select>
  <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</form>

<h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£</h2>
<table id="welfareTable">
  <thead>
    <tr>
      <th>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
      <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
      <th>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
      <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
      <th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
const supabaseUrl = 'https://ttottijljxoinptmhgtu.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const memberSelect = document.getElementById('memberSelect');
const welfareForm = document.getElementById('welfareForm');
const tableBody = document.querySelector('#welfareTable tbody');

let editWelfareId = null;

// Load members
async function loadMembers() {
  const { data, error } = await supabase.from('members').select('member_id,title,first_name,last_name,group');
  if(error) return console.error(error);
  memberSelect.innerHTML = '<option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>';
  data.forEach(m=>{
    const opt = document.createElement('option');
    opt.value = m.member_id;
    opt.textContent = `[${m.member_id}] ${m.title}${m.first_name} ${m.last_name} (‡∏Å‡∏•‡∏∏‡πà‡∏° ${m.group})`;
    memberSelect.appendChild(opt);
  });
}
loadMembers();

// Load welfare history
async function loadWelfare() {
  const { data, error } = await supabase.from('welfare').select('*');
  if(error) return console.error(error);
  tableBody.innerHTML = '';
  data.forEach(row=>{
    const tr = document.createElement('tr');
    const memberText = memberSelect.querySelector(`option[value="${row.member_id}"]`)?.textContent || row.member_id;
    tr.innerHTML = `
      <td>${memberText}</td>
      <td>${row.receive_date}</td>
      <td>${row.amount}</td>
      <td>${row.note}</td>
      <td><button class="edit" onclick="editRecord(${row.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
      <td><button class="delete" onclick="deleteRecord(${row.id})">‡∏•‡∏ö</button></td>
    `;
    tableBody.appendChild(tr);
  });
}
loadWelfare();

// Edit
window.editRecord = async function(id){
  const { data, error } = await supabase.from('welfare').select('*').eq('id',id).single();
  if(error) return console.error(error);
  editWelfareId = id;
  memberSelect.value = data.member_id;
  document.getElementById('receive_date').value = data.receive_date;
  document.getElementById('amount').value = data.amount;
  document.getElementById('note').value = data.note;
};

// Delete
window.deleteRecord = async function(id){
  if(!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?')) return;
  const { error } = await supabase.from('welfare').delete().eq('id',id);
  if(error) return console.error(error);
  loadWelfare();
};

// Submit
welfareForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const data = {
    member_id: memberSelect.value,
    receive_date: document.getElementById('receive_date').value,
    amount: parseFloat(document.getElementById('amount').value),
    note: document.getElementById('note').value
  };
  if(editWelfareId){
    const { error } = await supabase.from('welfare').update(data).eq('id',editWelfareId);
    if(error) return console.error(error);
    editWelfareId = null;
  } else {
    const { error } = await supabase.from('welfare').insert([data]);
    if(error) return console.error(error);
  }
  welfareForm.reset();
  loadWelfare();
});
</script>
</body>
</html>
