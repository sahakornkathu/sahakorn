<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
<style>
body{font-family:"Prompt",sans-serif; background:#f0f4f8; margin:20px; color:#333;}
h2{text-align:center; color:#1e40af; margin-bottom:15px;}
#formContainer{max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08);}
input, select, button{padding:6px 10px; margin:5px 0; border:1px solid #ccc; border-radius:6px; width:100%; font-size:14px;}
button{background:#4a90e2; color:#fff; border:none; cursor:pointer;}
button:hover{background:#357abd;}
table{border-collapse:collapse; width:100%; margin-top:20px;}
th, td{border:1px solid #e2e8f0; padding:6px; text-align:center;}
th{background:#4a90e2; color:#fff;}
tr:nth-child(even){background:#f9fafb;}
tr:hover{background:#edf2f7;}
.editBtn{background:#f59e0b;}
.editBtn:hover{background:#d97706;}
.deleteBtn{background:#f56565;}
.deleteBtn:hover{background:#c53030;}
</style>
</head>
<body>

<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>

<div id="formContainer">
  <label>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
  <select id="memberSelect"></select>

  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</label>
  <input type="date" id="receiveDate">

  <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
  <input type="number" id="amount">

  <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
  <select id="note">
    <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•--</option>
    <option value="‡∏û‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏û‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
    <option value="‡πÅ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡πÅ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
    <option value="‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
  </select>

  <button id="saveBtn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</div>

<h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£</h2>
<table id="welfareTable">
  <thead>
    <tr>
      <th>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
      <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
      <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
      <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
      <th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- ‡πÇ‡∏´‡∏•‡∏î Supabase ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
const supabaseUrl = 'https://ttottijljxoinptmhgtu.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ANON KEY ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

let editId = null;

// ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
async function loadMembers(){
  const { data, error } = await supabase.from('members').select('member_id, title, first_name, last_name, "group"');
  if(error) return alert(error.message);
  const select = document.getElementById('memberSelect');
  select.innerHTML = '<option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å--</option>';
  data.forEach(m=>{
    const option = document.createElement('option');
    option.value = m.member_id;
    option.textContent = `${m.title} ${m.first_name} ${m.last_name} (‡∏Å‡∏•‡∏∏‡πà‡∏° ${m.group})`;
    select.appendChild(option);
  });
}
loadMembers();

// ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
async function loadWelfare(){
  const { data, error } = await supabase.from('welfare').select('*');
  if(error) return console.log(error);
  const tbody = document.querySelector('#welfareTable tbody');
  tbody.innerHTML = '';
  data.forEach(row=>{
    const tr = document.createElement('tr');
    const memberText = row.member_name || row.member_id;
    tr.innerHTML = `
      <td>${memberText}</td>
      <td>${row.receive_date}</td>
      <td>${row.amount}</td>
      <td>${row.note}</td>
      <td><button class="editBtn" onclick="editWelfare(${row.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
      <td><button class="deleteBtn" onclick="deleteWelfare(${row.id})">‡∏•‡∏ö</button></td>
    `;
    tbody.appendChild(tr);
  });
}
loadWelfare();

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
document.getElementById('saveBtn').addEventListener('click', async()=>{
  const member_id = document.getElementById('memberSelect').value;
  const memberText = document.getElementById('memberSelect').selectedOptions[0].text;
  const receive_date = document.getElementById('receiveDate').value;
  const amount = document.getElementById('amount').value;
  const note = document.getElementById('note').value;

  if(!member_id || !receive_date || !amount || !note) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');

  const rowData = { member_id, member_name: memberText, receive_date, amount, note };
  let result;
  if(editId){
    result = await supabase.from('welfare').update(rowData).eq('id', editId);
    editId = null;
  } else {
    result = await supabase.from('welfare').insert([rowData]);
  }

  if(result.error) return alert(result.error.message);

  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°
  document.getElementById('memberSelect').value = '';
  document.getElementById('receiveDate').value = '';
  document.getElementById('amount').value = '';
  document.getElementById('note').value = '';
  loadWelfare();
});

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
async function editWelfare(id){
  const { data, error } = await supabase.from('welfare').select('*').eq('id', id).single();
  if(error) return alert(error.message);
  document.getElementById('memberSelect').value = data.member_id;
  document.getElementById('receiveDate').value = data.receive_date;
  document.getElementById('amount').value = data.amount;
  document.getElementById('note').value = data.note;
  editId = id;
}

// ‡∏•‡∏ö
async function deleteWelfare(id){
  if(!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
  const { error } = await supabase.from('welfare').delete().eq('id', id);
  if(error) return alert(error.message);
  loadWelfare();
}
</script>
</body>
</html>
