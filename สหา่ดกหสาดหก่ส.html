<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { font-family: sans-serif; background:#f3f4f6; padding:20px }
    h2 { margin-bottom:10px }
    form { background:#fff; padding:15px; border-radius:6px }
    input { padding:6px; margin:4px 0; width:200px }
    button { padding:6px 10px; margin-top:6px }
    table { width:100%; border-collapse:collapse; margin-top:20px; background:#fff }
    th, td { border:1px solid #ddd; padding:8px; text-align:left }
    th { background:#eee }
  </style>
</head>
<body>

<h2>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>

<form id="memberForm">
  <input type="hidden" id="id">

  <div>
    <input id="prefix" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤">
  </div>
  <div>
    <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required>
  </div>
  <div>
    <input id="lastname" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
  </div>
  <div>
    <input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
  </div>

  <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <button type="button" onclick="resetForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</form>

<table>
  <thead>
    <tr>
      <th>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠</th>
      <th>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
      <th>‡πÇ‡∏ó‡∏£</th>
      <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
    </tr>
  </thead>
  <tbody id="memberTable"></tbody>
</table>

<script>
/* ================= SUPABASE CONFIG ================= */
const SUPABASE_URL = 'https://ttottijljxoinptmhgtu.supabase.co'
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0b3R0aWpsanhvaW5wdG1oZ3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMTYxODQsImV4cCI6MjA3MzU5MjE4NH0.XnIf3xLzSbZDwFVKWjLTCiF4jnnDMQ1W95EI-v6F-3Y'

// ‚ùó ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ db ‡πÅ‡∏ó‡∏ô supabase (‡πÅ‡∏Å‡πâ error ‡∏ã‡πâ‡∏≥‡∏ä‡∏∑‡πà‡∏≠)
const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY)

/* ================= ELEMENT ================= */
const form = document.getElementById('memberForm')
const table = document.getElementById('memberTable')

/* ================= LOAD DATA ================= */
async function loadMembers() {
  const { data, error } = await db
    .from('members')
    .select('*')
    .order('created_at', { ascending: false })

  if (error) {
    alert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')
    console.error(error)
    return
  }

  table.innerHTML = ''
  data.forEach(m => {
    table.innerHTML += `
      <tr>
        <td>${m.prefix || ''}</td>
        <td>${m.name}</td>
        <td>${m.lastname}</td>
        <td>${m.phone || ''}</td>
        <td>
          <button onclick='editMember(${JSON.stringify(m)})'>‚úèÔ∏è</button>
          <button onclick="deleteMember('${m.id}')">üóë</button>
        </td>
      </tr>
    `
  })
}

/* ================= SAVE / UPDATE ================= */
form.addEventListener('submit', async (e) => {
  e.preventDefault()

  const id = document.getElementById('id').value

  const data = {
    prefix: prefix.value,
    name: name.value,
    lastname: lastname.value,
    phone: phone.value
  }

  let result
  if (id) {
    result = await db.from('members').update(data).eq('id', id)
  } else {
    result = await db.from('members').insert([data])
  }

  if (result.error) {
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')
    console.error(result.error)
    return
  }

  resetForm()
  loadMembers()
})

/* ================= EDIT ================= */
function editMember(m) {
  id.value = m.id
  prefix.value = m.prefix || ''
  name.value = m.name
  lastname.value = m.lastname
  phone.value = m.phone || ''
}

/* ================= DELETE ================= */
async function deleteMember(id) {
  if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?')) return

  const { error } = await db.from('members').delete().eq('id', id)
  if (error) {
    alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')
    console.error(error)
    return
  }

  loadMembers()
}

/* ================= RESET ================= */
function resetForm() {
  form.reset()
  document.getElementById('id').value = ''
}

/* ================= INIT ================= */
loadMembers()
</script>

</body>
</html>
